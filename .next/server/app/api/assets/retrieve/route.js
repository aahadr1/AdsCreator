(()=>{var e={};e.id=5474,e.ids=[5474],e.modules={2006:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2006,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},2455:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>E,staticGenerationAsyncStorage:()=>h});var s={};r.r(s),r.d(s,{POST:()=>l,runtime:()=>c});var i=r(49303),a=r(88716),n=r(60670),o=r(69498),u=r(9185),p=r.n(u);let c="nodejs";async function l(e){try{let t=process.env.SUPABASE_URL||"https://ueunqeqrvtuofpdoozye.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw";if(!t||!r)return new Response("Server misconfigured: missing SUPABASE_URL/SUPABASE_SERVICE_ROLE_KEY",{status:500});let s=process.env.REPLICATE_API_TOKEN;if(!s)return new Response("Server misconfigured: missing REPLICATE_API_TOKEN",{status:500});let i=new(p())({auth:s}),a=await e.json(),n=(a?.parts||[]).filter(e=>e&&"string"==typeof e.text);if(!n.length)return new Response("Missing parts",{status:400});let u=process.env.REPLICATE_EMBED_MODEL||"lucataco/snowflake-arctic-embed-l:38f2c666dd6a9f96c50eca69bbb0029ed03cba002a289983dc0b487a93cfb1b4",c=[];for(let e of n){let t=await i.run(u,{input:{prompt:e.text}}),r=Array.isArray(t)?t.map(e=>Number(e)):Array.isArray(t.data)?t.data.map(e=>Number(e)):[];c.push(r)}let l=(0,o.eI)(t,r,{auth:{persistSession:!1}}),d={};for(let e=0;e<n.length;e+=1){let t=n[e],r=c[e],s=Math.max(1,Math.min(50,Number(t.top_k)||8)),i=null;try{let{data:e}=await l.rpc("match_assets",{query_embedding:r,match_count:s});i=e||null}catch{}if(!i){let{data:e}=await l.from("assets").select("id, title, description, labels, keywords, public_url, kind, embedding").limit(200);i=(e||[]).map(e=>{let t=Array.isArray(e.embedding)?e.embedding.map(e=>Number(e)):[],s=t.length===r.length?t.reduce((e,t,s)=>e+t*r[s],0):0,i=Math.sqrt(t.reduce((e,t)=>e+t*t,0)),a=Math.sqrt(r.reduce((e,t)=>e+t*t,0)),n=i>0&&a>0?s/(i*a):0;return{...e,score:n}}).sort((e,t)=>t.score-e.score).slice(0,s)}d[t.id]=i}return Response.json({ok:!0,results:d})}catch(t){let e=t instanceof Error?t.message:"Internal error";return new Response(`Error: ${e}`,{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/assets/retrieve/route",pathname:"/api/assets/retrieve",filename:"route",bundlePath:"app/api/assets/retrieve/route"},resolvedPagePath:"/Users/Aaron/Downloads/next-lipsync-app/app/api/assets/retrieve/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:E}=d,b="/api/assets/retrieve/route";function f(){return(0,n.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,2659,9185,9498],()=>r(2455));module.exports=s})();