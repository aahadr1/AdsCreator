(()=>{var e={};e.id=418,e.ids=[418],e.modules={2006:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2006,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},40097:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>y,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>b});var r={};s.r(r),s.d(r,{POST:()=>d,runtime:()=>p});var i=s(49303),a=s(88716),n=s(60670),o=s(69498),u=s(9185),l=s.n(u);let p="nodejs";async function c({url:e,kind:t,replicate:s}){let r=`Media kind: ${t}. Media URL: ${e}. Produce JSON.`,i=await s.run("meta/meta-llama-3-8b-instruct",{input:{prompt:`You are an expert UGC ads creative editor. Given a media URL, return concise JSON with: title, description (1-2 sentences), labels (5-10 tags), keywords (8-20 search terms). Focus on what the clip visually contains and potential B-roll use cases. Return JSON only.

${r}`,max_tokens:512,temperature:.2}}),a="string"==typeof i?i:Array.isArray(i)?i.join("\n"):JSON.stringify(i),n=a.indexOf("{"),o=a.lastIndexOf("}"),u=n>=0&&o>=0?a.slice(n,o+1):a,l={};try{l=JSON.parse(u)}catch{}let p="string"==typeof l.title&&l.title.trim()?l.title.trim():"Untitled asset",c="string"==typeof l.description?l.description.trim():"",d=Array.isArray(l.labels)?l.labels.filter(e=>"string"==typeof e).slice(0,16):[],m=Array.isArray(l.keywords)?l.keywords.filter(e=>"string"==typeof e).slice(0,24):[],f=[p,c,d.join(" "),m.join(" ")].filter(Boolean).join("\n"),b=process.env.REPLICATE_EMBED_MODEL||"lucataco/snowflake-arctic-embed-l:38f2c666dd6a9f96c50eca69bbb0029ed03cba002a289983dc0b487a93cfb1b4",g=await s.run(b,{input:{prompt:f}});return{title:p,description:c,labels:d,keywords:m,embedding:Array.isArray(g)?g.map(e=>Number(e)):Array.isArray(g.data)?g.data.map(e=>Number(e)):[]}}async function d(e){try{let t=process.env.SUPABASE_URL||"https://ueunqeqrvtuofpdoozye.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw";if(!t||!s)return new Response("Server misconfigured: missing SUPABASE_URL/SUPABASE_SERVICE_ROLE_KEY",{status:500});let r=process.env.REPLICATE_API_TOKEN;if(!r)return new Response("Server misconfigured: missing REPLICATE_API_TOKEN",{status:500});let i=new(l())({auth:r}),{asset_id:a,storage_path:n,public_url:u,kind:p}=await e.json()||{};if(!a&&!n&&!u)return new Response("Provide one of asset_id, storage_path, or public_url",{status:400});let d=(0,o.eI)(t,s,{auth:{persistSession:!1}}),m=null;if(a){let{data:e}=await d.from("assets").select("id, public_url, storage_path, kind").eq("id",a).single();m=e||null}else if(n){let{data:e}=await d.from("assets").select("id, public_url, storage_path, kind").eq("storage_path",n).single();m=e||null}let f=u||m?.public_url,b=p||m?.kind||"video";if(!f)return new Response("Asset URL not found",{status:404});let g=await c({url:f,kind:b,replicate:i}),{data:y,error:_}=await d.from("assets").update({title:g.title,description:g.description,labels:g.labels,keywords:g.keywords,embedding:g.embedding,status:"indexed"}).eq("storage_path",m?.storage_path||n||"").select("*").single();if(_)return new Response(_.message,{status:500});return Response.json({ok:!0,asset:y})}catch(t){let e=t instanceof Error?t.message:"Internal error";return new Response(`Error: ${e}`,{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/assets/label/route",pathname:"/api/assets/label",filename:"route",bundlePath:"app/api/assets/label/route"},resolvedPagePath:"/Users/Aaron/Downloads/next-lipsync-app/app/api/assets/label/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:b,serverHooks:g}=m,y="/api/assets/label/route";function _(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:b})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,2659,9185,9498],()=>s(40097));module.exports=r})();