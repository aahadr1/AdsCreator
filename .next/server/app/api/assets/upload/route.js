"use strict";(()=>{var e={};e.id=8065,e.ids=[8065],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},6498:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>c});var s={};r.r(s),r.d(s,{POST:()=>p,runtime:()=>u});var a=r(49303),i=r(88716),o=r(60670),n=r(69498);let u="nodejs";async function p(e){try{let t=process.env.SUPABASE_URL||"https://ueunqeqrvtuofpdoozye.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",s=process.env.SUPABASE_ASSETS_BUCKET||"assets",a="true"===(process.env.SUPABASE_BUCKET_PUBLIC||"true").toLowerCase();if(!t||!r)return new Response("Server misconfigured: missing SUPABASE_URL/SUPABASE_SERVICE_ROLE_KEY",{status:500});let i=await e.formData(),o=null;try{let s=e.headers.get("authorization")||"",a=s.toLowerCase().startsWith("bearer ")?s.slice(7):"";if(a){let e=(0,n.eI)(t,r,{auth:{persistSession:!1},global:{headers:{Authorization:`Bearer ${a}`}}}),{data:{user:s}}=await e.auth.getUser();s?.id&&(o=s.id)}}catch{}let u=i.get("file"),p=i.get("filename");if(!u||!(u instanceof Blob))return new Response("No file provided",{status:400});let l=(0,n.eI)(t,r,{auth:{persistSession:!1}});try{let{data:e}=await l.storage.getBucket(s);if(!e&&(await l.storage.createBucket(s,{public:a}).catch(()=>{}),!(e=(await l.storage.getBucket(s)).data)))return new Response(`Bucket missing: "${s}" does not exist and could not be created. Create it in Supabase Storage or set SUPABASE_SERVICE_ROLE_KEY on the server.`,{status:500})}catch(t){let e=t instanceof Error?t.message:"Unknown error";return new Response(`Bucket check failed: ${e}`,{status:500})}let d=(p||("string"==typeof u.name?u.name:"upload.bin")).replace(/[^a-zA-Z0-9_.-]/g,"_"),c=`uploads/${Date.now()}-${d}`,g=await u.arrayBuffer(),m=u.type||"application/octet-stream",{error:f}=await l.storage.from(s).upload(c,new Uint8Array(g),{upsert:!1,cacheControl:"3600",contentType:m});if(f)return new Response(`Upload failed: ${f.message}`,{status:500});let h=a?l.storage.from(s).getPublicUrl(c).data.publicUrl:(await l.storage.from(s).createSignedUrl(c,60*60)).data?.signedUrl||"",S=function(e){let t=(e||"").toLowerCase();return t.startsWith("image/")?"image":t.startsWith("video/")?"video":/\.(png|jpg|jpeg|gif|webp)(\?|$)/i.test(t)?"image":"video"}(m),{data:w,error:E}=await l.from("media_assets").insert({storage_path:c,bucket:s,type:S,mime_type:m,public_url:h,status:"pending",created_by:o}).select("*").single();if(E)return new Response(E.message,{status:500});return Response.json({ok:!0,id:w.id,url:h,path:c,type:S,mime:m})}catch(t){let e=t instanceof Error?t.message:"Internal error";return new Response(`Error: ${e}`,{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/assets/upload/route",pathname:"/api/assets/upload",filename:"route",bundlePath:"app/api/assets/upload/route"},resolvedPagePath:"/Users/Aaron/Downloads/next-lipsync-app/app/api/assets/upload/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:g}=l,m="/api/assets/upload/route";function f(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:c})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,2659,9498],()=>r(6498));module.exports=s})();