(()=>{var e={};e.id=4091,e.ids=[4091],e.modules={2006:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2006,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},28381:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{POST:()=>d,runtime:()=>l});var i=s(49303),o=s(88716),n=s(60670),a=s(69498),u=s(9185),p=s.n(u);let l="nodejs";async function c({url:e,kind:t,replicate:s}){if("video"!==t)throw Error("Only video analysis is supported");try{let t=process.env.REPLICATE_API_TOKEN,r=await fetch("https://api.replicate.com/v1/models/lucataco/apollo-7b",{headers:{Authorization:`Token ${t}`},cache:"no-store"});if(!r.ok){let e=await r.text().catch(()=>"");throw Error(e||`Failed to resolve model version (${r.status})`)}let i=await r.json(),o=i?.latest_version?.id;if(!o)throw Error("No latest version found for lucataco/apollo-7b");let n=await s.run(`lucataco/apollo-7b:${o}`,{input:{video:e,prompt:"1) Briefly describe what happens in the video in 2â€“3 sentences. 2) Then, in exactly one sentence, state what this video is. Plain text only.",temperature:.4,max_new_tokens:256,top_p:.7}}),a="string"==typeof n?n:Array.isArray(n)?n.join("\n"):JSON.stringify(n);return String(a).trim().replace(/\s+/g," ")}catch(e){throw Error(e instanceof Error?e.message:"Apollo call failed")}}async function d(e){try{let t=process.env.SUPABASE_URL||"https://ueunqeqrvtuofpdoozye.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw";if(!t||!s)return new Response("Server misconfigured: missing SUPABASE_URL/SUPABASE_SERVICE_ROLE_KEY",{status:500});let r=process.env.REPLICATE_API_TOKEN||"";if(!r)return new Response("Server misconfigured: missing REPLICATE_API_TOKEN",{status:500});let i=new(p())({auth:r}),{asset_id:o,storage_path:n,public_url:u,type:l,dry_run:d}=await e.json()||{},m=(0,a.eI)(t,s,{auth:{persistSession:!1}}),f=null;if(o){let{data:e,error:t}=await m.from("media_assets").select("*").eq("id",o).single();if(t)return new Response(`Asset fetch error: ${t.message}`,{status:404});f=e}else if(n){let{data:e,error:t}=await m.from("media_assets").select("*").eq("storage_path",n).single();if(t)return new Response(`Asset fetch error: ${t.message}`,{status:404});f=e}let h=u||f?.public_url||"";if(!h)return new Response("Asset URL not found",{status:404});let w=l||((e,t)=>{let s=e.toLowerCase();return/\.(png|jpg|jpeg|webp|gif)(\?|$)/.test(s)?"image":/\.(mp4|mov|webm|m4v)(\?|$)/.test(s)?"video":t})(h,f?.type||"video");if("video"!==w)return new Response("Only video assets are supported for analysis",{status:400});let g=await c({url:h,kind:w,replicate:i});if(d)return Response.json({ok:!0,description:g});let v=f?.id||o||null;if(!v)return new Response("Asset id missing",{status:400});try{await m.from("media_descriptions").delete().eq("asset_id",v)}catch{}try{g&&await m.from("media_descriptions").insert({asset_id:v,description:g,source:"replicate"})}catch{}try{await m.from("media_assets").update({status:"ready"}).eq("id",v)}catch{}return Response.json({ok:!0,asset_id:v,description:g})}catch(t){let e=t instanceof Error?t.message:"Internal error";return new Response(`Error: ${e}`,{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ingest/asset/route",pathname:"/api/ingest/asset",filename:"route",bundlePath:"app/api/ingest/asset/route"},resolvedPagePath:"/Users/Aaron/Downloads/next-lipsync-app/app/api/ingest/asset/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:w}=m,g="/api/ingest/asset/route";function v(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,2659,9185,9498],()=>s(28381));module.exports=r})();