(()=>{var e={};e.id=665,e.ids=[665],e.modules={2006:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2006,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},57310:e=>{"use strict";e.exports=require("url")},59796:e=>{"use strict";e.exports=require("zlib")},278:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>y,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{POST:()=>l,runtime:()=>c});var n=r(49303),i=r(88716),a=r(60670),o=r(69498),u=r(9185),p=r.n(u);let c="nodejs";async function l(e){try{let t=process.env.SUPABASE_URL||"https://ueunqeqrvtuofpdoozye.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw";if(!t||!r)return new Response("Server misconfigured: missing SUPABASE_URL/SUPABASE_SERVICE_ROLE_KEY",{status:500});let s=process.env.REPLICATE_API_TOKEN||"";if(!s)return new Response("Server misconfigured: missing REPLICATE_API_TOKEN",{status:500});let n=await e.json(),i=(n?.text||"").trim();if(!i)return new Response("Missing text",{status:400});let a=new(p())({auth:s}),u=process.env.REPLICATE_SEGMENT_MODEL||"meta/meta-llama-3-8b-instruct",c=await a.run(u,{input:{prompt:`Segment ad script. Return JSON array of items: { start_sec|null, end_sec|null, text, intent, keywords[], visual_style }.

SCRIPT:
${i}

Return JSON array only.`,temperature:.1}}),l="string"==typeof c?c:Array.isArray(c)?c.join("\n"):JSON.stringify(c),d=l.indexOf("["),y=l.lastIndexOf("]"),_=d>=0&&y>=0?(()=>{try{return JSON.parse(l.slice(d,y+1))}catch{return[]}})():[],m=Array.isArray(_)?_.map((e,t)=>{let r=e&&"object"==typeof e?e:{};return{index:t,start_sec:"number"==typeof r.start_sec?r.start_sec:null,end_sec:"number"==typeof r.end_sec?r.end_sec:null,text:"string"==typeof r.text?r.text:"",intent:"string"==typeof r.intent?r.intent:"",keywords:Array.isArray(r.keywords)?r.keywords.filter(e=>"string"==typeof e):[],visual_style:"string"==typeof r.visual_style?r.visual_style:""}}):[];if(n?.dry_run===!0)return Response.json({ok:!0,segments:m});let f=(0,o.eI)(t,r,{auth:{persistSession:!1}}),{data:g}=await f.from("scripts").insert({raw_text:i,source_type:n?.source_type||"manual"}).select("*").single();if(g?.id){let e=m.map(e=>({script_id:g.id,start_sec:e.start_sec,end_sec:e.end_sec,text:e.text,intent:e.intent,keywords:e.keywords,visual_style:e.visual_style}));if(e.length)try{await f.from("script_segments").insert(e)}catch{}}return Response.json({ok:!0,script_id:g?.id,segments:m})}catch(t){let e=t instanceof Error?t.message:"Internal error";return new Response(`Error: ${e}`,{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/ingest/script/route",pathname:"/api/ingest/script",filename:"route",bundlePath:"app/api/ingest/script/route"},resolvedPagePath:"/Users/Aaron/Downloads/next-lipsync-app/app/api/ingest/script/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:y,staticGenerationAsyncStorage:_,serverHooks:m}=d,f="/api/ingest/script/route";function g(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:_})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,2659,9185,9498],()=>r(278));module.exports=s})();