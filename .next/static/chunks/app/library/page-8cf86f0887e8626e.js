(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[103],{1669:function(e,a,t){Promise.resolve().then(t.bind(t,5857))},5857:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var s=t(7437);t(8877);var i=t(2265),l=t(7138),n=t(6648),r=t(1180);function d(){let[e,a]=(0,i.useState)([]),[t,d]=(0,i.useState)("all"),[o,c]=(0,i.useState)(""),[p,u]=(0,i.useState)(""),[m,h]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[f,x]=(0,i.useState)([]);(0,i.useEffect)(()=>{(async()=>{h(!0);try{let[{data:e},{data:t},{data:s}]=await Promise.all([r._.from("media_assets").select("id, type, storage_path, status, public_url, created_at").order("created_at",{ascending:!1}).limit(60),r._.from("media_labels").select("asset_id, label"),r._.from("media_descriptions").select("asset_id, description")]);a(e||[]),b(t||[]),_(s||[])}finally{h(!1)}})()},[]);let[v,b]=(0,i.useState)([]),[j,_]=(0,i.useState)([]),w=(0,i.useMemo)(()=>{let e=new Map;for(let a of v){let t=e.get(a.asset_id)||[];t.push(a.label),e.set(a.asset_id,t)}return e},[v]),N=(0,i.useMemo)(()=>{let e=new Map;for(let a of j)"string"==typeof a.description&&e.set(a.asset_id,a.description);return e},[j]);async function I(){let e=document.createElement("input");e.type="file",e.accept="image/*,video/*",e.multiple=!0,e.onchange=async()=>{let t=Array.from(e.files||[]);if(!t.length)return;let s=t.slice(0,20);y(!0);try{let e=s.map(e=>({id:"".concat(Date.now(),"-").concat(e.name,"-").concat(Math.random().toString(36).slice(2,7)),name:e.name,status:"queued"}));x(a=>[...e,...a].slice(0,50)),await Promise.all(s.map(async(a,t)=>{let s=e[t].id,i=e=>x(a=>a.map(a=>a.id===s?{...a,...e}:a));try{i({status:"uploading"});let e=new FormData;e.append("file",a),e.append("filename",a.name);let t=await fetch("/api/assets/upload",{method:"POST",body:e});if(!t.ok)throw Error(await t.text());let s=await t.json();i({status:"indexing",url:s.url});let l=await fetch("/api/ingest/asset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({asset_id:s.id,public_url:s.url})});if(!l.ok)throw Error(await l.text());i({status:"ready"})}catch(e){i({status:"error"})}}));let{data:t}=await r._.from("media_assets").select("id, type, storage_path, status, public_url, created_at").order("created_at",{ascending:!1}).limit(60);a(t||[])}finally{y(!1)}},e.click()}let S=(0,i.useMemo)(()=>e.filter(e=>"all"===t||e.type===t),[e,t]);return(0,s.jsx)("div",{className:"container",style:{gridTemplateColumns:"1fr"},children:(0,s.jsxs)("div",{className:"panel output",children:[(0,s.jsx)("div",{className:"header",children:(0,s.jsx)("h2",{style:{margin:0},children:"Database"})}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,s.jsxs)("select",{className:"select",value:t,onChange:e=>d(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All"}),(0,s.jsx)("option",{value:"image",children:"Photos"}),(0,s.jsx)("option",{value:"video",children:"Videos"})]}),(0,s.jsx)("input",{className:"input",placeholder:"Filter by label (not wired)",value:o,onChange:e=>c(e.target.value)}),(0,s.jsx)("input",{className:"input",placeholder:"Search (semantic)",value:p,onChange:e=>u(e.target.value)}),(0,s.jsx)("button",{className:"btn",type:"button",onClick:I,disabled:g,children:g?"Uploading…":"Upload to Database (max 20)"})]}),m?(0,s.jsx)("div",{className:"small",style:{marginTop:12},children:"Loading…"}):null,f.length>0&&(0,s.jsxs)("div",{className:"panel",style:{padding:10,marginTop:12},children:[(0,s.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Bulk upload status"}),(0,s.jsx)("div",{style:{display:"grid",gap:8},children:f.map(e=>(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,border:"1px solid var(--border)",borderRadius:8,padding:8},children:[(0,s.jsx)("div",{className:"small",style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),(0,s.jsx)("span",{className:"badge",children:e.status.toUpperCase()})]},e.id))})]}),(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(240px, 1fr))",gap:12,marginTop:12},children:S.map(e=>(0,s.jsxs)("div",{className:"panel",style:{padding:10,position:"relative"},children:[(0,s.jsxs)("div",{className:"small",style:{display:"flex",justifyContent:"space-between"},children:[(0,s.jsxs)("span",{children:["#",e.id.slice(0,6)]}),(0,s.jsx)("span",{className:"badge",children:e.status})]}),(0,s.jsx)("div",{style:{marginTop:6},children:"image"===e.type&&e.public_url?(0,s.jsx)("div",{style:{position:"relative",width:"100%",aspectRatio:"16 / 9",borderRadius:8,overflow:"hidden"},children:(0,s.jsx)(n.default,{src:e.public_url,alt:"asset",fill:!0,style:{objectFit:"cover"}})}):"video"===e.type&&e.public_url?(0,s.jsx)("video",{src:"/api/proxy?type=video&url=".concat(encodeURIComponent(e.public_url)),controls:!0,crossOrigin:"anonymous",style:{width:"100%",borderRadius:8}}):(0,s.jsx)("div",{className:"small",style:{padding:8,opacity:.8},children:"No preview available"})}),(0,s.jsx)("div",{className:"small",style:{marginTop:6},children:e.storage_path}),N.get(e.id)&&(0,s.jsx)("div",{className:"small",style:{marginTop:6,opacity:.9},children:N.get(e.id)}),w.get(e.id)&&w.get(e.id).length>0&&(0,s.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,marginTop:6},children:w.get(e.id).slice(0,8).map(e=>(0,s.jsx)("span",{className:"badge",children:e},e))}),(0,s.jsx)(l.default,{href:"/library/".concat(e.id),className:"btn","aria-label":"View more details about this media",style:{position:"absolute",top:8,right:8,padding:"4px 8px"},children:"More"})]},e.id))})]})})}},1180:function(e,a,t){"use strict";t.d(a,{_:function(){return s}});let s=(0,t(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,648,138,971,23,744],function(){return e(e.s=1669)}),_N_E=e.O()}]);