(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[819],{6526:function(e,s,a){Promise.resolve().then(a.bind(a,5735))},5735:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return r}});var i=a(7437);a(8877);var l=a(2265),t=a(6648),n=a(6463);function r(){let e=(0,n.useParams)(),s=(0,n.useRouter)(),a=String((null==e?void 0:e.id)||""),[r,d]=(0,l.useState)(null),[o,c]=(0,l.useState)([]),[u,p]=(0,l.useState)(""),[y,m]=(0,l.useState)(null),[h,f]=(0,l.useState)(!1),[g,j]=(0,l.useState)(!1);async function x(){if(r){j(!0);try{let e=await fetch("/api/ingest/asset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({asset_id:r.id,public_url:r.public_url})});if(!e.ok)throw Error(await e.text());await new Promise(e=>setTimeout(e,500));let s=await fetch("/api/media/details",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({asset_id:r.id})});if(s.ok){let e=await s.json();m(e.analysis||null),p(e.description||""),c(e.labels||[])}}finally{j(!1)}}}(0,l.useEffect)(()=>{if(!a)return;let e=!1;return(async()=>{f(!0);try{let s=await fetch("/api/media/details",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({asset_id:a})});if(!s.ok)throw Error(await s.text());let i=await s.json();e||(d(i.asset||null),c(i.labels||[]),p(i.description||""),m(i.analysis||null))}finally{f(!1)}})(),()=>{e=!0}},[a]);let v=(0,l.useMemo)(()=>o.map(e=>e.label),[o]);return(0,i.jsx)("div",{className:"container",style:{gridTemplateColumns:"1fr"},children:(0,i.jsxs)("div",{className:"panel output",children:[(0,i.jsxs)("div",{className:"header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)("h2",{style:{margin:0},children:"Media details"}),(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{className:"btn",type:"button",onClick:x,disabled:g,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||g||x()},children:g?"Analyzing…":"Analyze now"}),(0,i.jsx)("button",{className:"btn",type:"button",onClick:()=>s.push("/library"),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&s.push("/library")},children:"Back to library"})]})]}),h&&(0,i.jsx)("div",{className:"small",style:{marginTop:8},children:"Loading…"}),r&&(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"360px 1fr",gap:16,marginTop:12},children:[(0,i.jsxs)("div",{className:"panel",style:{padding:10},children:["image"===r.type&&r.public_url?(0,i.jsx)("div",{style:{position:"relative",width:"100%",aspectRatio:"16 / 9",borderRadius:8,overflow:"hidden"},children:(0,i.jsx)(t.default,{src:r.public_url,alt:"asset preview",fill:!0,style:{objectFit:"cover"}})}):"video"===r.type&&r.public_url?(0,i.jsx)("video",{src:"/api/proxy?type=video&url=".concat(encodeURIComponent(r.public_url)),controls:!0,crossOrigin:"anonymous",style:{width:"100%",borderRadius:8}}):(0,i.jsx)("audio",{src:r.public_url||"",controls:!0,style:{width:"100%"}}),(0,i.jsx)("div",{className:"small",style:{marginTop:6,opacity:.9},children:r.storage_path}),(0,i.jsx)("div",{className:"small",style:{marginTop:6},children:(0,i.jsx)("span",{className:"badge",children:r.status})})]}),(0,i.jsxs)("div",{style:{display:"grid",gap:12},children:[u?(0,i.jsxs)("div",{className:"panel",style:{padding:10},children:[(0,i.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Description"}),(0,i.jsx)("div",{className:"small",children:u})]}):null,v.length>0&&(0,i.jsxs)("div",{className:"panel",style:{padding:10},children:[(0,i.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Labels"}),(0,i.jsx)("div",{style:{display:"flex",gap:6,flexWrap:"wrap"},children:v.map(e=>(0,i.jsx)("span",{className:"badge",children:e},e))})]}),(0,i.jsxs)("div",{className:"panel",style:{padding:10},children:[(0,i.jsx)("div",{className:"small",style:{fontWeight:700,marginBottom:6},children:"Analysis"}),y?(0,i.jsx)("div",{style:{display:"grid",gap:6},children:Object.entries(y).map(e=>{let[s,a]=e;return(0,i.jsxs)("div",{className:"small",style:{display:"grid",gridTemplateColumns:"160px 1fr",gap:8},children:[(0,i.jsx)("div",{style:{opacity:.8},children:s}),(0,i.jsx)("div",{children:Array.isArray(a)?a.join(", "):"object"==typeof a&&null!==a?JSON.stringify(a):String(null!=a?a:"")})]},s)})}):u?(0,i.jsx)("div",{className:"small",style:{whiteSpace:"pre-wrap"},children:u}):(0,i.jsx)("div",{className:"small",style:{opacity:.9},children:"No analysis available yet."})]})]})]})]})})}},6463:function(e,s,a){"use strict";var i=a(1169);a.o(i,"useParams")&&a.d(s,{useParams:function(){return i.useParams}}),a.o(i,"usePathname")&&a.d(s,{usePathname:function(){return i.usePathname}}),a.o(i,"useRouter")&&a.d(s,{useRouter:function(){return i.useRouter}})},8877:function(){}},function(e){e.O(0,[404,648,971,23,744],function(){return e(e.s=6526)}),_N_E=e.O()}]);