(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[756],{2807:function(e,a,t){Promise.resolve().then(t.bind(t,6434))},6434:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return n}});var s=t(7437);t(8877);var i=t(2265),l=t(1180);function n(){let[e,a]=(0,i.useState)([]),[t,n]=(0,i.useState)([]),[r,c]=(0,i.useState)("en"),[d,o]=(0,i.useState)(""),[u,p]=(0,i.useState)(0),[m,h]=(0,i.useState)(3),[f,x]=(0,i.useState)(!1),g=(0,i.useRef)([]),j=(0,i.useCallback)(()=>{n([]),a([])},[]),v=(0,i.useCallback)(e=>{if(!e)return;let t=Array.from(e);a(t),n(t.map((e,a)=>({id:"".concat(Date.now(),"-").concat(a,"-").concat(e.name),file:e,status:"queued"})))},[]),y=(0,i.useCallback)(async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let t=await fetch("/api/upload",{method:"POST",body:a});if(!t.ok)throw Error(await t.text());return(await t.json()).url},[]),b=(0,i.useCallback)(async e=>{let{data:{user:a}}=await l._.auth.getUser();if(!a)throw Error("Please sign in at /auth before creating tasks.");n(a=>a.map(a=>a.id===e.id?{...a,status:"uploading",error:null}:a));let t=await y(e.file);n(a=>a.map(a=>a.id===e.id?{...a,status:"running",audioUrl:t}:a));let s={language:r||void 0,prompt:d||void 0,temperature:u,audio_file:t},{data:i,error:c}=await l._.from("tasks").insert({user_id:a.id,type:"lipsync",status:"queued",provider:"replicate",model_id:"openai/gpt-4o-transcribe",options_json:s,audio_url:t,text_input:d||null}).select("*").single();if(c||!i)throw Error((null==c?void 0:c.message)||"Failed to create task");let o=await fetch("/api/transcription/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok)throw Error(await o.text());let p=(await o.json()).text||"";await l._.from("tasks").update({status:"finished"}).eq("id",i.id),n(a=>a.map(a=>a.id===e.id?{...a,status:"finished",transcript:p,taskId:i.id}:a))},[r,d,u,y]),w=(0,i.useCallback)(e=>{let a=new Blob([e.transcript||""],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(a),s=document.createElement("a");s.href=t,s.download=(e.file.name.replace(/\.[^.]+$/,"")||"transcript")+".txt",document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(t)},[]),N=(0,i.useCallback)(async()=>{if(f||0===t.length)return;x(!0),g.current=t.map(e=>({...e}));let e=[],a=async()=>{let e=g.current.find(e=>"queued"===e.status);if(e){e.status="uploading";try{await b(e)}catch(a){n(t=>t.map(t=>t.id===e.id?{...t,status:"error",error:(null==a?void 0:a.message)||"Error"}:t))}finally{await a()}}},s=Math.max(1,Math.min(10,Math.floor(m)));for(let t=0;t<s;t++)e.push(a());await Promise.all(e),x(!1)},[t,m,f,b]),k=(0,i.useMemo)(()=>t.filter(e=>"finished"===e.status).length,[t]),C=(0,i.useCallback)(()=>{let e=t.filter(e=>"finished"===e.status&&""!==(e.transcript||"").trim());if(0===e.length)return;let a=new Blob([e.map((e,a)=>{let t="=== ".concat(a+1,". ").concat(e.file.name," ===");return"".concat(t,"\n").concat(e.transcript,"\n")}).join("\n")],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="transcripts_".concat(new Date().toISOString().replace(/[:.]/g,"-"),".txt"),document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(s)},[t]);return(0,s.jsxs)("div",{className:"container",children:[(0,s.jsxs)("div",{className:"panel",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h3",{style:{margin:0},children:"Bulk Transcription"}),(0,s.jsxs)("span",{className:"badge",children:[k,"/",t.length," done"]})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Select up to 20 audio/video files"}),(0,s.jsx)("input",{type:"file",multiple:!0,accept:"audio/*,video/mp4,video/webm",onChange:e=>v(e.target.files)})]}),(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Language"}),(0,s.jsx)("input",{className:"input",value:r,onChange:e=>c(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Temperature"}),(0,s.jsx)("input",{className:"input",type:"number",step:.1,min:0,max:1,value:u,onChange:e=>p(parseFloat(e.target.value))})]})]})]}),(0,s.jsxs)("div",{style:{marginTop:12},children:[(0,s.jsx)("div",{className:"small",children:"Prompt (optional)"}),(0,s.jsx)("textarea",{className:"input",rows:3,value:d,onChange:e=>o(e.target.value),placeholder:"Style guide or context"})]}),(0,s.jsxs)("div",{className:"row",style:{marginTop:12},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Concurrency"}),(0,s.jsx)("input",{className:"input",type:"number",min:1,max:10,value:m,onChange:e=>h(parseInt(e.target.value||"1"))})]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"end",gap:8},children:[(0,s.jsx)("button",{className:"btn",disabled:0===e.length||f,onClick:N,children:f?"Running…":"Run all"}),(0,s.jsx)("button",{className:"btn",disabled:f,onClick:j,children:"Reset"}),(0,s.jsx)("button",{className:"btn",disabled:0===k,onClick:C,children:"Download all (.txt)"})]})]})]}),(0,s.jsxs)("div",{className:"panel",style:{marginTop:12},children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h3",{style:{margin:0},children:"Queue"}),(0,s.jsxs)("span",{className:"badge",children:[t.length," files"]})]}),(0,s.jsx)("div",{style:{display:"grid",gap:10},children:t.map(e=>(0,s.jsxs)("div",{className:"panel",style:{padding:10},children:[(0,s.jsxs)("div",{className:"row",style:{marginBottom:6},children:[(0,s.jsx)("div",{style:{fontWeight:700,overflow:"hidden",textOverflow:"ellipsis"},children:e.file.name}),(0,s.jsx)("span",{className:"badge",children:e.status})]}),e.transcript?(0,s.jsx)("div",{className:"small",style:{whiteSpace:"pre-wrap",maxHeight:160,overflow:"auto"},children:e.transcript}):e.error?(0,s.jsx)("div",{className:"small",style:{color:"#ff7878"},children:e.error}):(0,s.jsx)("div",{className:"small",style:{opacity:.8},children:"Awaiting result…"}),(0,s.jsxs)("div",{className:"row",style:{marginTop:6},children:[(0,s.jsx)("div",{className:"small",style:{opacity:.8},children:e.audioUrl?(0,s.jsx)("a",{href:e.audioUrl,target:"_blank",rel:"noreferrer",children:"audio"}):"no audio yet"}),(0,s.jsx)("div",{style:{display:"flex",gap:8},children:(0,s.jsx)("button",{className:"btn",disabled:!e.transcript,onClick:()=>w(e),children:"Download .txt"})})]})]},e.id))})]})]})}},1180:function(e,a,t){"use strict";t.d(a,{_:function(){return s}});let s=(0,t(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=2807)}),_N_E=e.O()}]);