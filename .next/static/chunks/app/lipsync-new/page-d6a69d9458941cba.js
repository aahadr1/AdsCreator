(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[135],{5783:function(e,a,l){Promise.resolve().then(l.bind(l,1244))},1244:function(e,a,l){"use strict";l.r(a),l.d(a,{default:function(){return r}});var s=l(7437);l(8877);var t=l(2265),i=l(1180),n=l(2277);function r(){var e;let[a,l]=(0,t.useState)(null),[r,c]=(0,t.useState)(null),[d,o]=(0,t.useState)(null),[u,p]=(0,t.useState)(null),[v,h]=(0,t.useState)(!1),[m,x]=(0,t.useState)(""),[g,j]=(0,t.useState)(""),[f,y]=(0,t.useState)(1),[N,k]=(0,t.useState)("kling"),[b,S]=(0,t.useState)("loop"),[w,C]=(0,t.useState)(.5),[I,_]=(0,t.useState)(20),[D,U]=(0,t.useState)(7.5),[T,M]=(0,t.useState)(!1),[O,E]=(0,t.useState)("default"),[A,F]=(0,t.useState)(!1),[P,R]=(0,t.useState)(!1),[B,J]=(0,t.useState)("audio"),[V,q]=(0,t.useState)("unknown"),[z,L]=(0,t.useState)(null),[Z,G]=(0,t.useState)(null),[Q,W]=(0,t.useState)([]),[X,Y]=(0,t.useState)(null),K=(0,t.useRef)(null),H=(0,t.useRef)(null),$=e=>W(a=>[...a,"".concat(new Date().toLocaleTimeString(),"  ").concat(e)]),ee=(0,t.useCallback)(async e=>{l(e)},[]),ea=(0,t.useCallback)(async e=>{c(e)},[]);async function el(){let e;if(!a||"sync2"===N&&!r||!v&&"kling"===N&&!r)return!1;if(d&&(v||u))return{videoUrl:d,audioUrl:u||void 0};$("Uploading files to storage...");let l=async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let l=await fetch("/api/upload",{method:"POST",body:a});if(!l.ok)throw Error(await l.text());return l.json()},s=await l(a);if(o(s.url),!v&&r){let a=await l(r);p(a.url),e=a.url}return $("Uploaded."),{videoUrl:s.url,audioUrl:e}}async function es(){try{q("queued"),W([]),G(null),L(null);let e=await el();if(!e){$("Please select required inputs."),q("unknown");return}let a="kling"===N?"kwaivgi/kling-lip-sync":"sync/lipsync-2",l="kling"===N?v?{video_url:e.videoUrl,text:m,voice_id:g||void 0,voice_speed:Number.isFinite(f)?f:void 0}:{video_url:e.videoUrl,audio_file:e.audioUrl}:{video:e.videoUrl,audio:e.audioUrl,sync_mode:b,temperature:w};$("Submitting to Replicate model: ".concat(a));let{data:{user:s}}=await i._.auth.getUser();s||$("Please sign in at /auth to save this job in Tasks.");let t=null;if(s){let{data:n,error:r}=await i._.from("tasks").insert({user_id:s.id,status:"queued",type:"lipsync",provider:"replicate",backend:a,options_json:l,text_input:"kling"===N&&v?m:null,video_url:e.videoUrl,audio_url:e.audioUrl||null}).select("*").single();r||!n?$("Warning: failed to save task: "+((null==r?void 0:r.message)||"unknown")):(t=n.id,Y(t),$("Task created: ".concat(t)))}let n=await fetch("/api/replicate/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:a,input:l})});if(!n.ok){$("Submission failed: "+await n.text()),q("failed");return}let r=await n.json();if(L(r.id),q(r.status||"queued"),$("Prediction created: ".concat(r.id)),t)try{await i._.from("tasks").update({status:r.status||"queued",job_id:r.id}).eq("id",t)}catch(e){}K.current&&clearInterval(K.current),K.current=setInterval(async()=>{if(!r.id)return;let e=await fetch("/api/replicate/status?id=".concat(r.id));if(!e.ok)return;let a=await e.json(),l=a.status||"unknown";if(H.current!==l&&($("Status: ".concat(l)),H.current=l),q(l),a.outputUrl&&"string"==typeof a.outputUrl){let e="/api/proxy?url=".concat(encodeURIComponent(a.outputUrl));G(e)}if(X||t)try{let e=a.outputUrl?"/api/proxy?url=".concat(encodeURIComponent(a.outputUrl)):null;await i._.from("tasks").update({status:l,output_url:e}).eq("id",X||t)}catch(e){}("succeeded"===l||"failed"===l||"canceled"===l)&&(clearInterval(K.current),K.current=null,a.error&&$("Error: ".concat("string"==typeof a.error?a.error:JSON.stringify(a.error))))},2e3)}catch(e){if($("Error: "+e.message),q("failed"),X)try{await i._.from("tasks").update({status:"failed"}).eq("id",X)}catch(e){}}}return(0,t.useEffect)(()=>()=>{K.current&&clearInterval(K.current)},[]),(0,s.jsxs)("div",{className:"container",children:[(0,s.jsxs)("div",{className:"panel output",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)("h2",{style:{margin:0},children:"Output"}),(0,s.jsx)("span",{className:"badge",children:(null===(e=V.toUpperCase)||void 0===e?void 0:e.call(V))||V})]}),(0,s.jsxs)("div",{className:"small",children:["Prediction ID: ",null!=z?z:"—"]})]}),(0,s.jsx)("div",{className:"outputArea",children:"succeeded"===V&&Z?(0,s.jsxs)("div",{children:[(0,s.jsx)("video",{src:Z,controls:!0,style:{maxWidth:"100%",maxHeight:"100%",borderRadius:12},onError:()=>$("Video failed to play. Open in new tab using the link below.")}),(0,s.jsx)("div",{className:"small",style:{marginTop:8},children:(0,s.jsx)("a",{href:Z,target:"_blank",rel:"noreferrer",children:"Open output in new tab"})}),(0,s.jsx)(n.Z,{mediaUrl:Z,kind:"video",size:"large",context:{model:"kling"===N?"kwaivgi/kling-lip-sync":"sync/lipsync-2",inputs:[{type:"video",url:d||void 0,label:"video"},v?{type:"text",text:m,label:"text"}:{type:"audio",url:u||void 0,label:"audio"}].filter(Boolean)}})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"The result will appear here."}),(0,s.jsxs)("div",{className:"kv",style:{marginTop:12},children:[(0,s.jsx)("div",{children:"Video URL"}),(0,s.jsx)("div",{className:"small",children:null!=d?d:"—"}),(0,s.jsx)("div",{children:"Audio URL"}),(0,s.jsx)("div",{className:"small",children:v?"(using text)":null!=u?u:"—"})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{margin:"8px 0 6px"},children:"Log"}),(0,s.jsx)("pre",{className:"log",children:Q.join("\n")})]})]}),(0,s.jsxs)("div",{className:"panel",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h3",{style:{margin:0},children:"Model Configuration"}),(0,s.jsx)("span",{className:"badge",children:"Multiple Providers"})]}),(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,s.jsx)("div",{className:"small",children:"Model"}),(0,s.jsxs)("select",{className:"select",value:N,onChange:e=>k(e.target.value),children:[(0,s.jsx)("option",{value:"kling",children:"Kling Lip-sync (kwaivgi/kling-lip-sync)"}),(0,s.jsx)("option",{value:"sync2",children:"Sync Lipsync 2.0 (sync/lipsync-2)"}),(0,s.jsx)("option",{value:"latentsync",children:"LatentSync (High Quality)"}),(0,s.jsx)("option",{value:"sieve",children:"Sieve Lipsync (sievesync-1.1)"})]})]}),"kling"===N&&(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:"var(--space-2)",alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:v,onChange:e=>h(e.target.checked)})," Use Text-to-Speech"]})})]}),"sync2"===N&&(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Sync Mode"}),(0,s.jsxs)("select",{className:"select",value:b,onChange:e=>S(e.target.value),children:[(0,s.jsx)("option",{value:"loop",children:"Loop"}),(0,s.jsx)("option",{value:"bounce",children:"Bounce"}),(0,s.jsx)("option",{value:"cut_off",children:"Cut Off"}),(0,s.jsx)("option",{value:"silence",children:"Silence"}),(0,s.jsx)("option",{value:"remap",children:"Remap"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Temperature"}),(0,s.jsx)("input",{className:"input",type:"number",step:.1,min:0,max:1,value:w,onChange:e=>C(Math.max(0,Math.min(1,Number(e.target.value))))})]})]}),"latentsync"===N&&(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Inference Steps"}),(0,s.jsx)("input",{className:"input",type:"number",min:1,max:50,value:I,onChange:e=>_(Math.max(1,Math.min(50,Number(e.target.value))))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Guidance Scale"}),(0,s.jsx)("input",{className:"input",type:"number",step:.5,min:1,max:20,value:D,onChange:e=>U(Math.max(1,Math.min(20,Number(e.target.value))))})]})]}),"sieve"===N&&(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Enhancement"}),(0,s.jsxs)("select",{className:"select",value:O,onChange:e=>E(e.target.value),children:[(0,s.jsx)("option",{value:"default",children:"Default"}),(0,s.jsx)("option",{value:"gfpgan",children:"GFPGAN"}),(0,s.jsx)("option",{value:"codeformer",children:"CodeFormer"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Cut By"}),(0,s.jsxs)("select",{className:"select",value:B,onChange:e=>J(e.target.value),children:[(0,s.jsx)("option",{value:"audio",children:"Audio"}),(0,s.jsx)("option",{value:"video",children:"Video"})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:"var(--space-2)",alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:T,onChange:e=>M(e.target.checked)})," Multi-speaker"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:"var(--space-2)",alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:A,onChange:e=>F(e.target.checked)})," Quality Check"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:"var(--space-2)",alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:P,onChange:e=>R(e.target.checked)})," Downsample"]})})]}),"kling"===N&&v&&(0,s.jsxs)("div",{className:"options",style:{marginTop:"var(--space-5)"},children:[(0,s.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,s.jsx)("div",{className:"small",children:"Text to Speech"}),(0,s.jsx)("textarea",{className:"input",rows:4,placeholder:"Type what the person should say...",value:m,onChange:e=>x(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Voice ID"}),(0,s.jsx)("input",{className:"input",placeholder:"en_AOT",value:g,onChange:e=>j(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Voice Speed"}),(0,s.jsx)("input",{className:"input",type:"number",step:.1,min:.5,max:2,value:f,onChange:e=>y(Number(e.target.value))})]})]}),(0,s.jsxs)("div",{className:"dnd",style:{marginTop:"var(--space-5)"},onDragOver:e=>{e.preventDefault()},onDrop:e=>{var a;e.preventDefault();let l=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];l&&ee(l)},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="video/*",e.onchange=()=>{var a;let l=(null===(a=e.files)||void 0===a?void 0:a[0])||null;l&&ee(l)},e.click()},children:[(0,s.jsx)("div",{className:"dnd-icon",children:"\uD83C\uDFAC"}),(0,s.jsx)("div",{className:"dnd-title",children:"Video File"}),(0,s.jsx)("div",{className:"dnd-subtitle",children:"MP4/MOV • clear face • 2–10s • 720p–1080p"}),a&&(0,s.jsxs)("div",{className:"fileInfo",children:["\uD83D\uDCF9 ",a.name," (",Math.round(a.size/1024/1024*10)/10," MB)"]}),d&&(0,s.jsx)("div",{className:"fileInfo",children:"\uD83D\uDD17 Uploaded successfully"})]}),!v&&(0,s.jsxs)("div",{className:"dnd",style:{marginTop:"var(--space-5)"},onDragOver:e=>{e.preventDefault()},onDrop:e=>{var a;e.preventDefault();let l=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];l&&ea(l)},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="audio/*",e.onchange=()=>{var a;let l=(null===(a=e.files)||void 0===a?void 0:a[0])||null;l&&ea(l)},e.click()},children:[(0,s.jsx)("div",{className:"dnd-icon",children:"\uD83C\uDFB5"}),(0,s.jsx)("div",{className:"dnd-title",children:"Audio File"}),(0,s.jsx)("div",{className:"dnd-subtitle",children:"WAV/MP3/M4A/AAC • < 5MB"}),r&&(0,s.jsxs)("div",{className:"fileInfo",children:["\uD83C\uDF99️ ",r.name," (",Math.round(r.size/1024/1024*10)/10," MB)"]}),u&&(0,s.jsx)("div",{className:"fileInfo",children:"\uD83D\uDD17 Uploaded successfully"})]}),(0,s.jsx)("button",{className:"btn",style:{marginTop:12},onClick:es,disabled:!("kling"===N?!!a&&(v?m.trim().length>0:!!r):"sync2"===N&&!!a&&!!r),children:"Generate"})]})]})}},2277:function(e,a,l){"use strict";var s=l(7437),t=l(2265),i=l(1180);a.Z=function(e){let{mediaUrl:a,kind:l,context:n,size:r="default"}=e,[c,d]=(0,t.useState)(!1),[o,u]=(0,t.useState)(!1),[p,v]=(0,t.useState)(null),[h,m]=(0,t.useState)("idle");async function x(){if(a){d(!0),v(null),u(!1);try{var e,s;let{data:{user:t}}=await i._.auth.getUser();if(!t)throw Error("Please sign in at /auth to save assets.");let r=await i._.auth.getSession(),c=(null===(e=r.data.session)||void 0===e?void 0:e.access_token)||"";m("pending");let d=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:c?"Bearer ".concat(c):""},body:JSON.stringify({url:a,kind:l,context:n})});if(!d.ok)throw Error(await d.text());u(!0),m("indexing");try{let e=await d.json(),a=null==e?void 0:null===(s=e.asset)||void 0===s?void 0:s.id;if(a){let e=setInterval(async()=>{try{let{data:l}=await i._.from("media_assets").select("status").eq("id",a).single(),s=(null==l?void 0:l.status)||"pending";"ready"===s&&(m("ready"),clearInterval(e)),"error"===s&&(m("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else m("ready")}catch(e){m("ready")}}catch(e){v(e instanceof Error?e.message:"Failed to add to database")}finally{d(!1)}}}return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,s.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:x,onKeyDown:e=>(function(e){let{event:a,onActivate:l}=e;("Enter"===a.key||" "===a.key)&&l()})({event:e,onActivate:x}),disabled:c,style:{padding:"large"===r?"12px 14px":"6px 10px",width:"large"===r?"100%":void 0,fontSize:"large"===r?16:void 0},children:c?"Saving to database…":o?"Saved ✓":"Save to database"}),"idle"!==h&&(0,s.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===h?"Pending":"indexing"===h?"Indexing":"ready"===h?"Ready":"error"===h?"Error":""}),p&&(0,s.jsx)("div",{className:"small",style:{color:"#ff7878"},children:p})]})}},1180:function(e,a,l){"use strict";l.d(a,{_:function(){return s}});let s=(0,l(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=5783)}),_N_E=e.O()}]);