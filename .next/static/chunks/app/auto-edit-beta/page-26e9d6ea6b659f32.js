(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[873],{7770:function(e,t,s){Promise.resolve().then(s.bind(s,6864))},6864:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437);s(8877);var i=s(2265),n=s(1180);function l(){let[e,t]=(0,i.useState)(""),[s,l]=(0,i.useState)(null),[r,d]=(0,i.useState)(null),[o,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)([]),[h,m]=(0,i.useState)({}),[g,y]=(0,i.useState)([]),[f,x]=(0,i.useState)([]),j=(0,i.useCallback)(e=>x(t=>[...t,"".concat(new Date().toLocaleTimeString(),"  ").concat(e)]),[]),v=(0,i.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.accept="audio/*",e.onchange=()=>{var t;let s=(null===(t=e.files)||void 0===t?void 0:t[0])||null;s&&l(s)},e.click()},[]),w=(0,i.useCallback)(async e=>{let t=new FormData;t.append("file",e),t.append("filename",e.name);let s=await fetch("/api/upload",{method:"POST",body:t});if(!s.ok)throw Error(await s.text());return(await s.json()).url},[]),b=(0,i.useCallback)(async()=>{if(e.trim())return e.trim();if(!s&&!r)throw Error("Provide script text or an audio file.");let a=r||(s?await w(s):null);if(!a)throw Error("No audio URL.");j("Transcribing via Replicate…");let i=await fetch("/api/transcription/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({audio_file:a})});if(!i.ok)throw Error(await i.text());let n=((await i.json()).text||"").trim();if(!n)throw Error("Empty transcript");return t(n),n},[s,r,j,e,w]),N=(0,i.useCallback)(async()=>{c(!0),p([]),m({}),y([]),x([]);try{let{data:{user:e}}=await n._.auth.getUser();if(!e)throw Error("Please sign in at /auth to use Auto Edit.");let t=await b();j("Segmenting script…");let s=await fetch("/api/script/segment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({script:t})});if(!s.ok)throw Error(await s.text());let a=await s.json(),i=(a.segments||[]).map((e,t)=>({...e,id:"seg_".concat(t)}));p(i),a.ideas_second_pass&&j("Generated rush ideas for segments (completed: ".concat("number"==typeof a.ideas_completed?a.ideas_completed:"n/a",")…"));let l=i.reduce((e,t)=>e+(t.rush_ideas&&t.rush_ideas.length>0?1:0),0);j("Rush ideas present for ".concat(l,"/").concat(i.length," segments.")),j("Retrieving matching assets…");let r=i.map(e=>({id:e.id,text:[e.text,e.desired_rush_description,...e.rush_ideas||[]].filter(Boolean).join("\n")})),d=await fetch("/api/assets/retrieve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({parts:r})});if(!d.ok)throw Error(await d.text());let o=await d.json();m(o.results||{}),j("Selecting best rush per segment…");let c=await fetch("/api/sequence/choose",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({segments:i,candidates:o.results})});if(!c.ok)throw Error(await c.text());let u=await c.json();y(u.items||[]),j("Done.")}catch(e){j(e instanceof Error?e.message:"Failed")}finally{c(!1)}},[b,j]);(0,i.useEffect)(()=>{s&&!r&&(async()=>{try{let e=await w(s);d(e)}catch(e){}})()},[s,r,w]);let _=(0,i.useMemo)(()=>{let e=new Map;for(let t of g)e.set(t.segment_id,t);return e},[g]);return(0,a.jsxs)("div",{className:"container",style:{gridTemplateColumns:"1fr"},children:[(0,a.jsxs)("div",{className:"panel output",children:[(0,a.jsx)("div",{className:"header",children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,a.jsx)("h2",{style:{margin:0},children:"Auto Edit (BETA)"}),(0,a.jsx)("span",{className:"badge",children:"Replicate-only"})]})}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"small",children:"Script (or transcribe from audio)"}),(0,a.jsx)("textarea",{className:"select",rows:8,placeholder:"Paste your ad script or leave empty and upload audio to transcribe",value:e,onChange:e=>t(e.target.value)}),(0,a.jsxs)("div",{className:"row",style:{marginTop:8,alignItems:"center",gap:8},children:[(0,a.jsx)("button",{className:"btn",type:"button",onClick:v,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&v()},children:"Upload audio for transcription"}),s&&(0,a.jsxs)("div",{className:"small",children:["\uD83C\uDF99️ ",s.name]}),r&&(0,a.jsxs)("div",{className:"small",children:["\uD83D\uDD17 Uploaded: ",r]})]}),(0,a.jsx)("button",{className:"btn",type:"button",style:{marginTop:12},disabled:o,onClick:N,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&N()},children:o?"Running…":"Run Auto Edit"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{margin:"8px 0 6px"},children:"Log"}),(0,a.jsx)("pre",{className:"log",children:f.join("\n")})]})]})]}),u.length>0&&(0,a.jsxs)("div",{className:"panel",style:{marginTop:12},children:[(0,a.jsx)("div",{className:"header",children:(0,a.jsx)("h3",{style:{margin:0},children:"Sequence"})}),(0,a.jsx)("div",{style:{display:"grid",gap:12},children:u.map(e=>{let t=_.get(e.id)||null,s=h[e.id]||[],i=t&&s.find(e=>e.id===t.chosen_asset_id)||null;return(0,a.jsxs)("div",{className:"panel",style:{padding:12},children:[(0,a.jsxs)("div",{className:"small",style:{opacity:.9},children:["Part ",e.index+1]}),(0,a.jsx)("div",{style:{fontWeight:700,marginBottom:4},children:e.text}),(0,a.jsxs)("div",{className:"small",style:{marginBottom:8,opacity:.8},children:["Rush needed: ",e.desired_rush_description||"—"]}),(0,a.jsxs)("div",{className:"small",style:{marginBottom:8},children:[(0,a.jsx)("div",{style:{opacity:.8,marginBottom:4},children:"Rush ideas:"}),e.rush_ideas&&e.rush_ideas.length>0?(0,a.jsx)("ul",{style:{margin:0,paddingLeft:18},children:e.rush_ideas.slice(0,3).map((e,t)=>(0,a.jsx)("li",{children:e},t))}):(0,a.jsx)("div",{style:{opacity:.7},children:"—"})]}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"260px 1fr",gap:12},children:[(0,a.jsx)("div",{children:i?"image"===i.kind||/\.(png|jpg|jpeg|gif|webp)(\?|$)/i.test(i.public_url)?(0,a.jsx)("img",{src:i.public_url,alt:i.title||"Selected image",style:{width:240,maxWidth:"100%",borderRadius:8}}):(0,a.jsx)("video",{src:i.public_url,controls:!0,style:{width:240,maxWidth:"100%",borderRadius:8}}):(0,a.jsx)("div",{className:"small",style:{opacity:.7},children:"No selection"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"small",style:{marginBottom:6},children:"Candidates"}),(0,a.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:s.slice(0,6).map(e=>(0,a.jsxs)("a",{href:e.public_url,target:"_blank",rel:"noreferrer",className:"small",style:{border:"1px solid var(--border)",borderRadius:8,padding:6},children:[e.title||"asset","number"==typeof e.score?" (".concat(Math.round(100*e.score)/100,")"):""]},e.id))}),(null==t?void 0:t.reason)&&(0,a.jsxs)("div",{className:"small",style:{marginTop:8,opacity:.8},children:["Reason: ",t.reason]})]})]})]},e.id)})})]})]})}},1180:function(e,t,s){"use strict";s.d(t,{_:function(){return a}});let a=(0,s(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=7770)}),_N_E=e.O()}]);