(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{817:function(e,a,t){Promise.resolve().then(t.bind(t,837))},837:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return r}});var s=t(7437);t(8877);var n=t(2265),l=t(1180),i=t(2277);function r(){let[e,a]=(0,n.useState)("black-forest-labs/flux-kontext-max"),[t,r]=(0,n.useState)("A stunning digital artwork of a futuristic cityscape at sunset, with neon lights reflecting on wet streets"),[o,d]=(0,n.useState)("blurry, low quality, distorted, ugly"),[c,u]=(0,n.useState)("match_input_image"),[m,p]=(0,n.useState)("png"),[h,g]=(0,n.useState)(""),[x,v]=(0,n.useState)(2),[f,j]=(0,n.useState)(!1),[b,y]=(0,n.useState)(7.5),[N,k]=(0,n.useState)(80),[w,_]=(0,n.useState)(1),[S,C]=(0,n.useState)(25),[I,O]=(0,n.useState)(.8),[T,D]=(0,n.useState)(1024),[P,E]=(0,n.useState)(1024),[M,F]=(0,n.useState)(""),[R,G]=(0,n.useState)([]),[J,U]=(0,n.useState)(!1),[W,A]=(0,n.useState)(!1),[q,B]=(0,n.useState)(null),[Z,z]=(0,n.useState)(null),[X,L]=(0,n.useState)(null),[Q,K]=(0,n.useState)(null),V=(0,n.useCallback)(async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let t=await fetch("/api/upload",{method:"POST",body:a});if(!t.ok)throw Error(await t.text());return(await t.json()).url},[]);async function Y(e){try{let a=await fetch("/api/persist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,filename:e.split("/").pop()||null,folder:"image"})});if(!a.ok)return e;let t=await a.json();return"string"==typeof(null==t?void 0:t.url)?t.url:e}catch(a){return e}}async function H(){A(!0),B(null),z(null);try{let{data:{user:a}}=await l._.auth.getUser();if(!a)throw Error("Please sign in at /auth before creating a task.");let s={model:e,prompt:t};"black-forest-labs/flux-kontext-max"===e?Object.assign(s,{input_image:M||void 0,aspect_ratio:c,output_format:m,seed:""===h.trim()?void 0:Number(h),safety_tolerance:"number"==typeof x?x:void 0,prompt_upsampling:f}):"google/nano-banana"===e?Object.assign(s,{image_input:R.length?R:M?[M]:void 0,output_format:m}):"black-forest-labs/flux-krea-dev"===e&&Object.assign(s,{image:M||void 0,aspect_ratio:["1:1","16:9","21:9","3:2","2:3","4:5","5:4","3:4","4:3","9:16","9:21"].includes(c)?c:"1:1",output_format:m||"webp",seed:""===h.trim()?void 0:Number(h),guidance:b,num_outputs:Math.min(4,Math.max(1,Number(w)||1)),output_quality:Math.min(100,Math.max(0,Number(N)||80))});let{data:n,error:i}=await l._.from("tasks").insert({user_id:a.id,type:"lipsync",status:"queued",provider:"replicate",model_id:e,options_json:s,text_input:t}).select("*").single();if(i||!n)throw Error((null==i?void 0:i.message)||"Failed to create task");K(n.id);let r=await fetch("/api/image/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((()=>{let a={model:e,prompt:t,output_format:m};return"black-forest-labs/flux-kontext-max"===e?(a.input_image=M||void 0,a.aspect_ratio=c,a.seed=""===h.trim()?void 0:Number(h),a.safety_tolerance="number"==typeof x?x:void 0,a.prompt_upsampling=f):"google/nano-banana"===e?a.image_input=R.length?R:M?[M]:void 0:"black-forest-labs/flux-krea-dev"===e&&(a.input_image=M||void 0,a.aspect_ratio=["1:1","16:9","21:9","3:2","2:3","4:5","5:4","3:4","4:3","9:16","9:21"].includes(c)?c:"1:1",a.seed=""===h.trim()?void 0:Number(h),a.guidance=b,a.num_outputs=Math.min(4,Math.max(1,Number(w)||1)),a.output_quality=Math.min(100,Math.max(0,Number(N)||80))),a})())});if(!r.ok)throw Error(await r.text());let o=await r.json();if(!o.url)throw Error("No image URL returned");let d=await Y(o.url),u="/api/proxy?url=".concat(encodeURIComponent(d));L(d),z(u),(null==n?void 0:n.id)&&await l._.from("tasks").update({status:"finished",output_url:d}).eq("id",n.id)}catch(e){B((null==e?void 0:e.message)||"Failed to generate image"),Q&&await l._.from("tasks").update({status:"error"}).eq("id",Q)}finally{A(!1)}}return(0,s.jsxs)("div",{className:"container",children:[(0,s.jsxs)("div",{className:"panel output",children:[(0,s.jsx)("div",{className:"header",children:(0,s.jsx)("h2",{style:{margin:0},children:"Output"})}),(0,s.jsx)("div",{className:"outputArea",children:Z?(0,s.jsxs)("div",{children:[(0,s.jsx)("img",{src:Z,alt:"Generated image",style:{maxWidth:"100%",borderRadius:8},onError:()=>B("Failed to load image. Try the direct link below.")}),(0,s.jsxs)("div",{className:"small",style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap",justifyContent:"center"},children:[(0,s.jsx)("a",{href:Z,target:"_blank",rel:"noreferrer",style:{padding:"8px 12px",background:"var(--panel-elevated)",borderRadius:"6px",textDecoration:"none"},children:"Open via proxy"}),X?(0,s.jsx)("a",{href:X,target:"_blank",rel:"noreferrer",style:{padding:"8px 12px",background:"var(--panel-elevated)",borderRadius:"6px",textDecoration:"none"},children:"Open direct"}):null,(0,s.jsx)("a",{href:"".concat(Z).concat(Z.includes("?")?"&":"?","download=true"),style:{padding:"8px 12px",background:"var(--accent)",color:"white",borderRadius:"6px",textDecoration:"none"},children:"Download"})]}),(0,s.jsx)(i.Z,{mediaUrl:X||Z,kind:"image",size:"large",context:{prompt:t,model:e,inputs:M||R.length?[{type:"image",url:M||R[0],label:"input_image"}]:void 0}})]}):(0,s.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"Generated image will appear here."})}),q&&(0,s.jsx)("div",{className:"small",style:{color:"#ff7878"},children:q})]}),(0,s.jsxs)("div",{className:"panel",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h3",{style:{margin:0},children:"Model Configuration"}),(0,s.jsx)("span",{className:"badge",children:"AI Image Generation"})]}),(0,s.jsx)("div",{className:"options",children:(0,s.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,s.jsx)("div",{className:"small",children:"Model"}),(0,s.jsxs)("select",{className:"select",value:e,onChange:e=>a(e.target.value),children:[(0,s.jsx)("option",{value:"black-forest-labs/flux-kontext-max",children:"FLUX Kontext Max (Best Quality)"}),(0,s.jsx)("option",{value:"black-forest-labs/flux-krea-dev",children:"FLUX Krea Dev (Fast)"}),(0,s.jsx)("option",{value:"google/nano-banana",children:"Google Nano Banana"}),(0,s.jsx)("option",{value:"stability-ai/stable-diffusion-3",children:"Stable Diffusion 3"}),(0,s.jsx)("option",{value:"bytedance/hyper-sd",children:"ByteDance Hyper-SD"})]})]})}),(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,s.jsx)("div",{className:"small",children:"Prompt"}),(0,s.jsx)("textarea",{className:"input",value:t,onChange:e=>r(e.target.value),rows:4,placeholder:"Describe the image you want to generate or edit..."})]}),(0,s.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,s.jsx)("div",{className:"small",children:"Negative Prompt (Optional)"}),(0,s.jsx)("textarea",{className:"input",value:o,onChange:e=>d(e.target.value),rows:2,placeholder:"What to avoid in the image..."})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Input image (optional)"}),(0,s.jsxs)("div",{className:"dnd ".concat(J?"drag":""),onDragOver:e=>{e.preventDefault(),U(!0)},onDragLeave:e=>{e.preventDefault(),U(!1)},onDrop:async a=>{a.preventDefault(),U(!1);let t=Array.from(a.dataTransfer.files||[]).filter(e=>e.type.startsWith("image/"));if(t.length)try{let a=await Promise.all(t.map(e=>V(e)));"google/nano-banana"===e?G(e=>[...e,...a]):F(a[0])}catch(e){B((null==e?void 0:e.message)||"Upload failed")}},onClick:()=>{let a=document.createElement("input");a.type="file",a.accept="image/*","google/nano-banana"===e&&(a.multiple=!0),a.onchange=async()=>{let t=Array.from(a.files||[]);if(t.length)try{let a=await Promise.all(t.map(e=>V(e)));"google/nano-banana"===e?G(e=>[...e,...a]):F(a[0])}catch(e){B((null==e?void 0:e.message)||"Upload failed")}},a.click()},children:[(0,s.jsx)("div",{className:"dnd-icon",children:"\uD83D\uDDBC️"}),(0,s.jsx)("div",{className:"dnd-title",children:"Reference Image"}),(0,s.jsx)("div",{className:"dnd-subtitle",children:"PNG/JPG/GIF/WebP • Optional for image editing"}),"google/nano-banana"===e?R.length>0&&(0,s.jsx)("div",{className:"fileInfo",style:{marginTop:"var(--space-3)",display:"flex",flexWrap:"wrap",gap:"var(--space-2)"},children:R.map((e,a)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("img",{src:e,alt:"input-".concat(a),style:{maxWidth:120,borderRadius:"var(--radius-lg)"}}),(0,s.jsx)("div",{className:"small",style:{marginTop:"var(--space-1)"},children:(0,s.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:"Open"})})]},e+a))}):M&&(0,s.jsxs)("div",{className:"fileInfo",style:{marginTop:"var(--space-3)"},children:[(0,s.jsx)("img",{src:M,alt:"input",style:{maxWidth:240,borderRadius:"var(--radius-lg)"}}),(0,s.jsx)("div",{className:"small",style:{marginTop:"var(--space-2)"},children:(0,s.jsx)("a",{href:M,target:"_blank",rel:"noreferrer",children:"Open image"})})]})]}),"google/nano-banana"===e?R.length>0&&(0,s.jsx)("button",{className:"btn",style:{marginTop:8},onClick:()=>G([]),children:"Clear images"}):M&&(0,s.jsx)("button",{className:"btn",style:{marginTop:8},onClick:()=>F(""),children:"Clear image"})]}),(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Aspect Ratio"}),(0,s.jsx)("select",{className:"select",value:c,onChange:e=>u(e.target.value),children:"black-forest-labs/flux-kontext-max"===e?["match_input_image","1:1","16:9","9:16","4:3","3:4","3:2","2:3","4:5","5:4","21:9","9:21","2:1","1:2"].map(e=>(0,s.jsx)("option",{value:e,children:e},e)):["1:1","16:9","21:9","3:2","2:3","4:5","5:4","3:4","4:3","9:16","9:21"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Output Format"}),(0,s.jsxs)("select",{className:"select",value:m,onChange:e=>p(e.target.value),children:[(0,s.jsx)("option",{value:"png",children:"PNG"}),(0,s.jsx)("option",{value:"jpg",children:"JPG"}),"black-forest-labs/flux-krea-dev"===e&&(0,s.jsx)("option",{value:"webp",children:"WebP"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Seed"}),(0,s.jsx)("input",{className:"input",type:"number",value:h,onChange:e=>g(e.target.value),placeholder:"Random if empty"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Number of Images"}),(0,s.jsx)("input",{className:"input",type:"number",min:1,max:4,value:w,onChange:e=>_(parseInt(e.target.value||"1"))})]})]}),(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Guidance Scale"}),(0,s.jsx)("input",{className:"input",type:"number",step:.5,min:1,max:20,value:b,onChange:e=>y(parseFloat(e.target.value||"7.5"))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Steps"}),(0,s.jsx)("input",{className:"input",type:"number",min:1,max:100,value:S,onChange:e=>C(parseInt(e.target.value||"25"))})]}),M&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Strength"}),(0,s.jsx)("input",{className:"input",type:"number",step:.1,min:0,max:1,value:I,onChange:e=>O(parseFloat(e.target.value||"0.8"))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Quality"}),(0,s.jsx)("input",{className:"input",type:"number",min:0,max:100,value:N,onChange:e=>k(parseInt(e.target.value||"80"))})]})]}),"black-forest-labs/flux-kontext-max"===e&&(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Safety Tolerance"}),(0,s.jsx)("input",{className:"input",type:"number",min:0,max:6,value:x,onChange:e=>v(parseInt(e.target.value||"2"))})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:"var(--space-2)",alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:f,onChange:e=>j(e.target.checked)})," Prompt Upsampling"]})})]}),(0,s.jsx)("button",{className:"btn",style:{marginTop:12},disabled:!t.trim()||W,onClick:H,children:W?"Generating…":"Generate image"})]})]})}},2277:function(e,a,t){"use strict";var s=t(7437),n=t(2265),l=t(1180);a.Z=function(e){let{mediaUrl:a,kind:t,context:i,size:r="default"}=e,[o,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null),[h,g]=(0,n.useState)("idle");async function x(){if(a){d(!0),p(null),u(!1);try{var e,s;let{data:{user:n}}=await l._.auth.getUser();if(!n)throw Error("Please sign in at /auth to save assets.");let r=await l._.auth.getSession(),o=(null===(e=r.data.session)||void 0===e?void 0:e.access_token)||"";g("pending");let d=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?"Bearer ".concat(o):""},body:JSON.stringify({url:a,kind:t,context:i})});if(!d.ok)throw Error(await d.text());u(!0),g("indexing");try{let e=await d.json(),a=null==e?void 0:null===(s=e.asset)||void 0===s?void 0:s.id;if(a){let e=setInterval(async()=>{try{let{data:t}=await l._.from("media_assets").select("status").eq("id",a).single(),s=(null==t?void 0:t.status)||"pending";"ready"===s&&(g("ready"),clearInterval(e)),"error"===s&&(g("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else g("ready")}catch(e){g("ready")}}catch(e){p(e instanceof Error?e.message:"Failed to add to database")}finally{d(!1)}}}return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,s.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:x,onKeyDown:e=>(function(e){let{event:a,onActivate:t}=e;("Enter"===a.key||" "===a.key)&&t()})({event:e,onActivate:x}),disabled:o,style:{padding:"large"===r?"12px 14px":"6px 10px",width:"large"===r?"100%":void 0,fontSize:"large"===r?16:void 0},children:o?"Saving to database…":c?"Saved ✓":"Save to database"}),"idle"!==h&&(0,s.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===h?"Pending":"indexing"===h?"Indexing":"ready"===h?"Ready":"error"===h?"Error":""}),m&&(0,s.jsx)("div",{className:"small",style:{color:"#ff7878"},children:m})]})}},1180:function(e,a,t){"use strict";t.d(a,{_:function(){return s}});let s=(0,t(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=817)}),_N_E=e.O()}]);