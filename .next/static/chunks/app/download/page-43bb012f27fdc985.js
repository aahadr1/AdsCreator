(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40],{6697:function(e,t,a){Promise.resolve().then(a.bind(a,5710))},5710:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return o}});var i=a(7437);a(8877);var n=a(2265),r=a(6648),s=a(2277),l=a(1180);function o(){let[e,t]=(0,n.useState)(""),[a,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[c,h]=(0,n.useState)(null),[p,f]=(0,n.useState)(null),[m,y]=(0,n.useState)(null);function g(e){let{event:t,onActivate:a}=e;("Enter"===t.key||" "===t.key)&&a()}async function v(){o(!0),u(null),h(null);try{let{data:{user:t}}=await l._.auth.getUser();if(!t)throw Error("Please sign in at /auth before creating a task.");let{data:a,error:i}=await l._.from("tasks").insert({user_id:t.id,type:"download",status:"queued",provider:"tikwm",backend:"tikwm-downloader",text_input:e}).select("*").single();if(i||!a)throw Error((null==i?void 0:i.message)||"Failed to create task");y(a.id);let n=await fetch("/api/download/tiktok",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!n.ok)throw Error(await n.text());let r=await n.json();if(!r.url)throw Error("No media URL returned");f(r.url),h("/api/proxy?type=video&url=".concat(encodeURIComponent(r.url))),(null==a?void 0:a.id)&&await l._.from("tasks").update({status:"finished",output_url:r.url}).eq("id",a.id)}catch(e){u(e instanceof Error?e.message:"Failed to download"),m&&await l._.from("tasks").update({status:"error"}).eq("id",m)}finally{o(!1)}}async function w(){o(!0),u(null),h(null);try{let{data:{user:t}}=await l._.auth.getUser();if(!t)throw Error("Please sign in at /auth before creating a task.");let{data:a,error:i}=await l._.from("tasks").insert({user_id:t.id,type:"download",status:"queued",provider:"yt-dlp",backend:"yt-dlp",text_input:e}).select("*").single();if(i||!a)throw Error((null==i?void 0:i.message)||"Failed to create task");y(a.id);let n=await fetch("/api/download/tiktok",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})});if(!n.ok)throw Error(await n.text());let r=await n.json();if(!r.url)throw Error("No media URL returned");f(r.url),h("/api/proxy?type=video&url=".concat(encodeURIComponent(r.url))),(null==a?void 0:a.id)&&await l._.from("tasks").update({status:"succeeded",output_url:r.url}).eq("id",a.id)}catch(e){u(e instanceof Error?e.message:"Failed to download"),m&&await l._.from("tasks").update({status:"failed"}).eq("id",m)}finally{o(!1)}}let x=/\.(png|jpg|jpeg|gif|webp)(\?|$)/i.test(String(p||c||""));return(0,i.jsxs)("div",{className:"container",children:[(0,i.jsxs)("div",{className:"panel output",children:[(0,i.jsx)("div",{className:"header",children:(0,i.jsx)("h2",{style:{margin:0},children:"Output"})}),(0,i.jsx)("div",{className:"outputArea",children:c?x?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.default,{src:c,alt:"Downloaded image",width:1280,height:720,style:{maxWidth:"100%",height:"auto",borderRadius:8}}),(0,i.jsx)(s.Z,{mediaUrl:p||c,kind:"image"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("video",{controls:!0,preload:"metadata",playsInline:!0,style:{maxWidth:"100%",borderRadius:8},onError:()=>u("Failed to load video. Try the direct link below."),children:[(0,i.jsx)("source",{src:c,type:"video/mp4"}),p&&p!==c?(0,i.jsx)("source",{src:p}):null]}),(0,i.jsxs)("div",{className:"small",style:{marginTop:8},children:[(0,i.jsx)("a",{href:c,target:"_blank",rel:"noreferrer",children:"Open via proxy"}),p?(0,i.jsxs)(i.Fragment,{children:[" ","|"," ",(0,i.jsx)("a",{href:p,target:"_blank",rel:"noreferrer",children:"Open direct"})]}):null]}),(0,i.jsx)(s.Z,{mediaUrl:p||c,kind:"video"})]}):(0,i.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"Downloaded media will appear here."})}),d&&(0,i.jsx)("div",{className:"small",style:{color:"#ff7878"},children:d})]}),(0,i.jsxs)("div",{className:"panel",children:[(0,i.jsx)("div",{className:"header",children:(0,i.jsx)("h3",{style:{margin:0},children:"Inputs"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"small",children:"Video URL (TikTok/TikTok Ads)"}),(0,i.jsx)("input",{className:"input",value:e,onChange:e=>t(e.target.value),placeholder:"https://..."})]}),(0,i.jsx)("button",{className:"btn",type:"button",style:{marginTop:12},disabled:!e.trim()||a,onClick:v,onKeyDown:e=>g({event:e,onActivate:v}),children:a?"Downloading…":"Download"}),(0,i.jsx)("button",{className:"btn",type:"button",style:{marginTop:12},disabled:!e.trim()||a,onClick:w,onKeyDown:e=>g({event:e,onActivate:w}),children:a?"Downloading…":"Download via Open Source (yt-dlp)"})]})]})}},2277:function(e,t,a){"use strict";var i=a(7437),n=a(2265),r=a(1180);t.Z=function(e){let{mediaUrl:t,kind:a,context:s,size:l="default"}=e,[o,d]=(0,n.useState)(!1),[u,c]=(0,n.useState)(!1),[h,p]=(0,n.useState)(null),[f,m]=(0,n.useState)("idle");async function y(){if(t){d(!0),p(null),c(!1);try{var e,i;let{data:{user:n}}=await r._.auth.getUser();if(!n)throw Error("Please sign in at /auth to save assets.");let l=await r._.auth.getSession(),o=(null===(e=l.data.session)||void 0===e?void 0:e.access_token)||"";m("pending");let d=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?"Bearer ".concat(o):""},body:JSON.stringify({url:t,kind:a,context:s})});if(!d.ok)throw Error(await d.text());c(!0),m("indexing");try{let e=await d.json(),t=null==e?void 0:null===(i=e.asset)||void 0===i?void 0:i.id;if(t){let e=setInterval(async()=>{try{let{data:a}=await r._.from("media_assets").select("status").eq("id",t).single(),i=(null==a?void 0:a.status)||"pending";"ready"===i&&(m("ready"),clearInterval(e)),"error"===i&&(m("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else m("ready")}catch(e){m("ready")}}catch(e){p(e instanceof Error?e.message:"Failed to add to database")}finally{d(!1)}}}return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,i.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:y,onKeyDown:e=>(function(e){let{event:t,onActivate:a}=e;("Enter"===t.key||" "===t.key)&&a()})({event:e,onActivate:y}),disabled:o,style:{padding:"large"===l?"12px 14px":"6px 10px",width:"large"===l?"100%":void 0,fontSize:"large"===l?16:void 0},children:o?"Saving to database…":u?"Saved ✓":"Save to database"}),"idle"!==f&&(0,i.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===f?"Pending":"indexing"===f?"Indexing":"ready"===f?"Ready":"error"===f?"Error":""}),h&&(0,i.jsx)("div",{className:"small",style:{color:"#ff7878"},children:h})]})}},1180:function(e,t,a){"use strict";a.d(t,{_:function(){return i}});let i=(0,a(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,648,971,23,744],function(){return e(e.s=6697)}),_N_E=e.O()}]);