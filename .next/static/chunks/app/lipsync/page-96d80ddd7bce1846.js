(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{2643:function(e,a,t){Promise.resolve().then(t.bind(t,9643))},9643:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return r}});var s=t(7437);t(8877);var l=t(2265),i=t(1180),n=t(2277);function r(){let[e,a]=(0,l.useState)(null),[t,r]=(0,l.useState)(null),[d,o]=(0,l.useState)(null),[c,u]=(0,l.useState)(null),[p,v]=(0,l.useState)(!1),[h,f]=(0,l.useState)(!1),[m,x]=(0,l.useState)(null),[g,y]=(0,l.useState)("unknown"),[j,b]=(0,l.useState)([]),[k,_]=(0,l.useState)(null),[w,N]=(0,l.useState)("sieve"),[S,I]=(0,l.useState)("sievesync-1.1"),[U,D]=(0,l.useState)("default"),[C,T]=(0,l.useState)("audio"),[O,E]=(0,l.useState)(!1),[P,J]=(0,l.useState)(!1),[q,M]=(0,l.useState)(!1),[R,L]=(0,l.useState)("loop"),[F,V]=(0,l.useState)(.5),[z,A]=(0,l.useState)(!1),B=(0,l.useRef)(null),W=(0,l.useRef)(null),Z=e=>b(a=>{let t=new Date().toLocaleTimeString();return[...a,"".concat(t,"  ").concat(e)]}),Y=(0,l.useCallback)(async e=>{a(e)},[]),X=(0,l.useCallback)(async e=>{r(e)},[]);async function Q(){if(!e||!t)return!1;if(d&&c)return{videoUrl:d,audioUrl:c};Z("Uploading files to Supabase...");let a=async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let t=await fetch("/api/upload",{method:"POST",body:a});if(!t.ok)throw Error(await t.text()||"upload failed");return t.json()},[s,l]=await Promise.all([a(e),a(t)]);return o(s.url),u(l.url),Z("Uploaded to Supabase."),{videoUrl:s.url,audioUrl:l.url}}async function G(){try{let{data:{user:e}}=await i._.auth.getUser();if(!e){Z("Please sign in at /auth before creating a task.");return}let a=await Q();if(!a)return;y("queued"),b([]),Z("Creating task...");let t="sieve"===w?{backend:S,enable_multispeaker:O,enhance:U,check_quality:P,downsample:q,cut_by:C}:{sync_mode:R,temperature:F,active_speaker:z},{data:s,error:l}=await i._.from("tasks").insert({user_id:e.id,status:"queued",type:"lipsync",provider:"sieve"===w?"sieve":"replicate",backend:"sieve"===w?S:"lipsync-2-pro",options_json:t,video_url:a.videoUrl,audio_url:a.audioUrl}).select("*").single();if(l||!s){Z("Failed to create task: "+((null==l?void 0:l.message)||"unknown")),y("error");return}if(_(s.id),Z("Task created. Pushing lipsync job to ".concat("sieve"===w?"Sieve":"Sync","...")),"sieve"===w){let e=await fetch("/api/lipsync/push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:a.videoUrl,audioUrl:a.audioUrl,options:t})});if(!e.ok){let a=await e.text();Z("Push failed: "+a),y("error"),(null==s?void 0:s.id)&&await i._.from("tasks").update({status:"error"}).eq("id",s.id);return}let l=await e.json();x(l.id),y(l.status),Z("Job created: ".concat(l.id,", status=").concat(l.status)),(null==s?void 0:s.id)&&await i._.from("tasks").update({job_id:l.id,status:l.status}).eq("id",s.id),B.current&&clearInterval(B.current),B.current=setInterval(async()=>{if(!l.id)return;let e=await fetch("/api/lipsync/status?id=".concat(l.id));if(!e.ok)return;let a=await e.json();if(W.current!==a.status&&(Z("Status: ".concat(a.status)),W.current=a.status),a.error&&Z("Error detail: ".concat("string"==typeof a.error?a.error:JSON.stringify(a.error))),Array.isArray(a.logs)&&a.logs.length&&Z("Logs: ".concat(JSON.stringify(a.logs.slice(-3)))),y(a.status),("finished"===a.status||"error"===a.status||"cancelled"===a.status)&&(clearInterval(B.current),B.current=null),a.outputs){window.__SIEVE_OUTPUTS__=a.outputs;let e=(()=>{for(let t of a.outputs){var e;if((null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.url)&&"string"==typeof t.data.url)return t.data.url;if((null==t?void 0:t.url)&&"string"==typeof t.url)return t.url}return null})();(null==s?void 0:s.id)&&await i._.from("tasks").update({status:a.status,output_url:e}).eq("id",s.id)}else(null==s?void 0:s.id)&&await i._.from("tasks").update({status:a.status}).eq("id",s.id)},1800)}else{let e=await fetch("/api/lipsync-beta/push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({videoUrl:a.videoUrl,audioUrl:a.audioUrl,model:"lipsync-2-pro",options:{sync_mode:R,temperature:F,active_speaker:z}})});if(!e.ok){let a=await e.text();Z("Push failed: "+a),y("error"),(null==s?void 0:s.id)&&await i._.from("tasks").update({status:"error"}).eq("id",s.id);return}let t=await e.json();x(t.id);let l="queued";y(l),Z("Job created: ".concat(t.id,", status=").concat(t.status||l)),(null==s?void 0:s.id)&&await i._.from("tasks").update({job_id:t.id,status:l}).eq("id",s.id),B.current&&clearInterval(B.current),B.current=setInterval(async()=>{if(!t.id)return;let e=await fetch("/api/lipsync-beta/status?id=".concat(t.id));if(!e.ok)return;let a=await e.json(),l="COMPLETED"===a.status||"succeeded"===a.status?"finished":"FAILED"===a.status?"error":"PROCESSING"===a.status?"running":"QUEUED"===a.status?"queued":a.status;if(W.current!==l&&(Z("Status: ".concat(l)),W.current=l),y(l),("finished"===l||"error"===l)&&(clearInterval(B.current),B.current=null),a.outputUrl||a.upscaledUrl){window.__SYNC_OUTPUT_URL__=a.upscaledUrl||a.outputUrl;let e=a.upscaledUrl||a.outputUrl||null;(null==s?void 0:s.id)&&await i._.from("tasks").update({status:l,output_url:e}).eq("id",s.id)}else(null==s?void 0:s.id)&&await i._.from("tasks").update({status:l}).eq("id",s.id);a.error&&Z("Error detail: ".concat("string"==typeof a.error?a.error:JSON.stringify(a.error)))},2e3)}}catch(e){Z("Error: "+e.message),y("error")}}let K=(()=>{let e=window,a=e&&e.__SIEVE_OUTPUTS__||null,t=e&&e.__SYNC_OUTPUT_URL__||null;if(t)return t;if(!a)return null;for(let e of a){var s;if((null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.url)&&"string"==typeof e.data.url)return e.data.url;if((null==e?void 0:e.url)&&"string"==typeof e.url)return e.url}return null})();return(0,l.useEffect)(()=>()=>{B.current&&clearInterval(B.current)},[]),(0,s.jsxs)("div",{className:"container",children:[(0,s.jsxs)("div",{className:"panel output",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"},children:[(0,s.jsx)("h2",{style:{margin:0},children:"Output"}),(0,s.jsx)("span",{className:"badge",children:g.toUpperCase()})]}),(0,s.jsxs)("div",{className:"small mobile-hide",children:["Job ID: ",null!=m?m:"—"]})]}),(0,s.jsx)("div",{className:"outputArea",children:"finished"===g&&K?(0,s.jsxs)("div",{children:[(()=>{let e="/api/proxy?type=video&url=".concat(encodeURIComponent(String(K)));return(0,s.jsxs)("div",{children:[(0,s.jsxs)("video",{controls:!0,preload:"metadata",playsInline:!0,style:{maxWidth:"100%",maxHeight:"100%",borderRadius:12},children:[(0,s.jsx)("source",{src:e,type:"video/mp4"}),(0,s.jsx)("source",{src:K})]}),(0,s.jsxs)("div",{className:"small",style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap",justifyContent:"center"},children:[(0,s.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",style:{padding:"8px 12px",background:"var(--panel-elevated)",borderRadius:"6px",textDecoration:"none"},children:"Open via proxy"}),(0,s.jsx)("a",{href:K,target:"_blank",rel:"noreferrer",style:{padding:"8px 12px",background:"var(--panel-elevated)",borderRadius:"6px",textDecoration:"none"},children:"Open direct"}),(0,s.jsx)("a",{href:"".concat(e,"&download=true"),style:{padding:"8px 12px",background:"var(--accent)",color:"white",borderRadius:"6px",textDecoration:"none"},children:"Download"})]})]})})(),(0,s.jsx)(n.Z,{mediaUrl:K,kind:"video",size:"large",context:{model:S,inputs:[{type:"video",url:d||void 0,label:"video"},{type:"audio",url:c||void 0,label:"audio"}].filter(Boolean),extra:{engine:w}}})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"The result will appear here."}),(0,s.jsxs)("div",{className:"kv",style:{marginTop:12},children:[(0,s.jsx)("div",{children:"Video URL"}),(0,s.jsx)("div",{className:"small",children:null!=d?d:"—"}),(0,s.jsx)("div",{children:"Audio URL"}),(0,s.jsx)("div",{className:"small",children:null!=c?c:"—"})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{margin:"8px 0 6px"},children:"Log"}),(0,s.jsx)("pre",{className:"log",children:j.join("\n")})]})]}),(0,s.jsxs)("div",{className:"panel",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h3",{style:{margin:0},children:"Inputs"}),(0,s.jsx)("span",{className:"badge",children:"Drag & Drop"})]}),(0,s.jsxs)("div",{className:"dnd ".concat(p?"drag":""),onDragOver:e=>{e.preventDefault(),v(!0)},onDragLeave:e=>{e.preventDefault(),v(!1)},onDrop:e=>{var a;e.preventDefault(),v(!1);let t=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];t&&Y(t)},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="video/*",e.onchange=()=>{var a;let t=(null===(a=e.files)||void 0===a?void 0:a[0])||null;t&&Y(t)},e.click()},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:"Video"}),(0,s.jsx)("div",{className:"small",children:"MP4/MOV recommended • clear face, single speaker"}),e&&(0,s.jsxs)("div",{className:"fileInfo",children:["\uD83D\uDCF9 ",e.name," (",Math.round(e.size/1024/1024*10)/10," MB)"]}),d&&(0,s.jsxs)("div",{className:"fileInfo",children:["\uD83D\uDD17 Uploaded: ",d]})]}),(0,s.jsxs)("div",{className:"dnd ".concat(h?"drag":""),style:{marginTop:12},onDragOver:e=>{e.preventDefault(),f(!0)},onDragLeave:e=>{e.preventDefault(),f(!1)},onDrop:e=>{var a;e.preventDefault(),f(!1);let t=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];t&&X(t)},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="audio/*",e.onchange=()=>{var a;let t=(null===(a=e.files)||void 0===a?void 0:a[0])||null;t&&X(t)},e.click()},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:"Voiceover"}),(0,s.jsx)("div",{className:"small",children:"WAV/MP3 preferred • same language & pacing"}),t&&(0,s.jsxs)("div",{className:"fileInfo",children:["\uD83C\uDF99️ ",t.name," (",Math.round(t.size/1024/1024*10)/10," MB)"]}),c&&(0,s.jsxs)("div",{className:"fileInfo",children:["\uD83D\uDD17 Uploaded: ",c]})]}),(0,s.jsx)("div",{style:{marginTop:16,fontWeight:700},children:"Options"}),(0,s.jsxs)("div",{className:"options",children:[(0,s.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,s.jsx)("div",{className:"small",children:"Engine"}),(0,s.jsxs)("select",{className:"select",value:w,onChange:e=>N(e.target.value),children:[(0,s.jsx)("option",{value:"sieve",children:"Sieve (current)"}),(0,s.jsx)("option",{value:"sync",children:"Sync lipsync-2-pro (new)"})]})]}),"sieve"===w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Backend"}),(0,s.jsxs)("select",{className:"select",value:S,onChange:e=>I(e.target.value),children:[(0,s.jsx)("option",{value:"sievesync-1.1",children:"sievesync-1.1 (recommended)"}),(0,s.jsx)("option",{value:"sync-2.0",children:"sync-2.0"}),(0,s.jsx)("option",{value:"sync-1.9.0-beta",children:"sync-1.9.0-beta"}),(0,s.jsx)("option",{value:"hummingbird",children:"hummingbird"}),(0,s.jsx)("option",{value:"latentsync",children:"latentsync"}),(0,s.jsx)("option",{value:"sievesync",children:"sievesync"}),(0,s.jsx)("option",{value:"musetalk",children:"musetalk"}),(0,s.jsx)("option",{value:"video_retalking",children:"video_retalking"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Enhance"}),(0,s.jsxs)("select",{className:"select",value:U,onChange:e=>D(e.target.value),children:[(0,s.jsx)("option",{value:"default",children:"default"}),(0,s.jsx)("option",{value:"none",children:"none"})]})]}),(0,s.jsxs)("div",{className:"row",children:[(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:O,onChange:e=>E(e.target.checked)})," multispeaker"]}),(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:P,onChange:e=>J(e.target.checked)})," check quality"]})]}),(0,s.jsx)("div",{className:"row",children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:q,onChange:e=>M(e.target.checked)})," downsample (720p)"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Cut by"}),(0,s.jsxs)("select",{className:"select",value:C,onChange:e=>T(e.target.value),children:[(0,s.jsx)("option",{value:"audio",children:"audio"}),(0,s.jsx)("option",{value:"video",children:"video"}),(0,s.jsx)("option",{value:"shortest",children:"shortest"})]})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"sync_mode"}),(0,s.jsxs)("select",{className:"select",value:R,onChange:e=>L(e.target.value),children:[(0,s.jsx)("option",{value:"loop",children:"loop"}),(0,s.jsx)("option",{value:"bounce",children:"bounce"}),(0,s.jsx)("option",{value:"cut_off",children:"cut_off"}),(0,s.jsx)("option",{value:"silence",children:"silence"}),(0,s.jsx)("option",{value:"remap",children:"remap"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"temperature (0-1)"}),(0,s.jsx)("input",{className:"select",type:"number",step:"0.1",min:0,max:1,value:F,onChange:e=>V(Math.max(0,Math.min(1,Number(e.target.value))))})]}),(0,s.jsx)("div",{className:"row",children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:z,onChange:e=>A(e.target.checked)})," active_speaker"]})})]})]}),(0,s.jsx)("button",{className:"btn",onClick:G,disabled:!e||!t,children:"Lipsync it"}),(0,s.jsx)("div",{className:"small",style:{marginTop:8},children:"Tip: clear, front‑facing face; single speaker works best."})]})]})}},2277:function(e,a,t){"use strict";var s=t(7437),l=t(2265),i=t(1180);a.Z=function(e){let{mediaUrl:a,kind:t,context:n,size:r="default"}=e,[d,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)(!1),[p,v]=(0,l.useState)(null),[h,f]=(0,l.useState)("idle");async function m(){if(a){o(!0),v(null),u(!1);try{var e,s;let{data:{user:l}}=await i._.auth.getUser();if(!l)throw Error("Please sign in at /auth to save assets.");let r=await i._.auth.getSession(),d=(null===(e=r.data.session)||void 0===e?void 0:e.access_token)||"";f("pending");let o=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:d?"Bearer ".concat(d):""},body:JSON.stringify({url:a,kind:t,context:n})});if(!o.ok)throw Error(await o.text());u(!0),f("indexing");try{let e=await o.json(),a=null==e?void 0:null===(s=e.asset)||void 0===s?void 0:s.id;if(a){let e=setInterval(async()=>{try{let{data:t}=await i._.from("media_assets").select("status").eq("id",a).single(),s=(null==t?void 0:t.status)||"pending";"ready"===s&&(f("ready"),clearInterval(e)),"error"===s&&(f("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else f("ready")}catch(e){f("ready")}}catch(e){v(e instanceof Error?e.message:"Failed to add to database")}finally{o(!1)}}}return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,s.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:m,onKeyDown:e=>(function(e){let{event:a,onActivate:t}=e;("Enter"===a.key||" "===a.key)&&t()})({event:e,onActivate:m}),disabled:d,style:{padding:"large"===r?"12px 14px":"6px 10px",width:"large"===r?"100%":void 0,fontSize:"large"===r?16:void 0},children:d?"Saving to database…":c?"Saved ✓":"Save to database"}),"idle"!==h&&(0,s.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===h?"Pending":"indexing"===h?"Indexing":"ready"===h?"Ready":"error"===h?"Error":""}),p&&(0,s.jsx)("div",{className:"small",style:{color:"#ff7878"},children:p})]})}},1180:function(e,a,t){"use strict";t.d(a,{_:function(){return s}});let s=(0,t(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=2643)}),_N_E=e.O()}]);