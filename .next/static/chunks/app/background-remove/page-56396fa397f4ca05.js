(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[785],{1905:function(e,t,a){Promise.resolve().then(a.bind(a,6782))},6782:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return r}});var i=a(7437);a(8877);var l=a(2265),s=a(1180),n=a(2277);function r(){var e;let[t,a]=(0,l.useState)(null),[r,o]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),[u,p]=(0,l.useState)("unknown"),[v,f]=(0,l.useState)([]),[m,h]=(0,l.useState)(null),[g,y]=(0,l.useState)(null),[x,j]=(0,l.useState)("Normal"),[b,w]=(0,l.useState)("#FFFFFF"),k=(0,l.useRef)(null),N=(0,l.useRef)(null),S=e=>f(t=>[...t,"".concat(new Date().toLocaleTimeString(),"  ").concat(e)]),I=(0,l.useCallback)(e=>a(e),[]),_=(0,l.useCallback)(async e=>{let t=new FormData;t.append("file",e),t.append("filename",e.name);let a=await fetch("/api/upload",{method:"POST",body:t});if(!a.ok)throw Error(await a.text());return(await a.json()).url},[]);async function F(e){try{let t=await fetch("/api/persist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,filename:e.split("/").pop()||null,folder:"bgremove"})});if(!t.ok)return e;let a=await t.json();return"string"==typeof(null==a?void 0:a.url)?a.url:e}catch(t){return e}}async function C(){p("queued"),f([]),c(null),h(null);try{let{data:{user:e}}=await s._.auth.getUser();if(!e){S("Please sign in at /auth before creating a task."),p("failed");return}if(!t){S("Please select a video file."),p("failed");return}let a=r;a||(S("Uploading video…"),a=await _(t),o(a),S("Uploaded."));let i={video:a,mode:x,background_color:b},{data:l,error:n}=await s._.from("tasks").insert({user_id:e.id,type:"bgremove",status:"queued",provider:"replicate",backend:"lucataco/rembg-video",options_json:i,video_url:a}).select("*").single();if(n||!l){S("Failed to create task: "+((null==n?void 0:n.message)||"unknown")),p("failed");return}y(l.id),S("Submitting to Replicate: lucataco/rembg-video");let d=await fetch("/api/replicate/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"lucataco/rembg-video",input:i})});if(!d.ok){S("Submission failed: "+await d.text()),p("failed");return}let u=await d.json();h(u.id);let v=u.status||"queued";p(v),S("Prediction created: ".concat(u.id)),(null==l?void 0:l.id)&&await s._.from("tasks").update({job_id:u.id,status:v}).eq("id",l.id),k.current&&clearInterval(k.current),k.current=setInterval(async()=>{if(!u.id)return;let e=await fetch("/api/replicate/status?id=".concat(u.id));if(!e.ok)return;let t=await e.json(),a=t.status||"unknown";if(N.current!==a&&(S("Status: ".concat(a)),N.current=a),p(a),t.outputUrl&&"string"==typeof t.outputUrl){let e=await F(t.outputUrl),a="/api/proxy?url=".concat(encodeURIComponent(e));c(a)}if(null==l?void 0:l.id){let e=t.outputUrl?"/api/proxy?url=".concat(encodeURIComponent(t.outputUrl)):null;await s._.from("tasks").update({status:a,output_url:e}).eq("id",l.id)}("succeeded"===a||"failed"===a||"canceled"===a)&&(clearInterval(k.current),k.current=null,t.error&&S("Error: ".concat("string"==typeof t.error?t.error:JSON.stringify(t.error))))},2e3)}catch(e){S("Error: "+(null==e?void 0:e.message)),p("failed"),g&&await s._.from("tasks").update({status:"error"}).eq("id",g)}}return(0,l.useEffect)(()=>()=>{k.current&&clearInterval(k.current)},[]),(0,i.jsxs)("div",{className:"container",children:[(0,i.jsxs)("div",{className:"panel output",children:[(0,i.jsxs)("div",{className:"header",children:[(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("h2",{style:{margin:0},children:"Output"}),(0,i.jsx)("span",{className:"badge",children:(null===(e=u.toUpperCase)||void 0===e?void 0:e.call(u))||u})]}),(0,i.jsxs)("div",{className:"small",children:["Prediction ID: ",null!=m?m:"—"]})]}),(0,i.jsx)("div",{className:"outputArea",children:d?(0,i.jsxs)("div",{children:[(0,i.jsx)("video",{src:d,controls:!0,style:{width:"100%",borderRadius:8},onError:()=>S("Video failed to play. Open in new tab using the link below.")}),(0,i.jsx)("div",{className:"small",style:{marginTop:8},children:(0,i.jsx)("a",{href:d,target:"_blank",rel:"noreferrer",children:"Open output in new tab"})}),(0,i.jsx)(n.Z,{mediaUrl:d,kind:"video",size:"large",context:{model:"lucataco/rembg-video",inputs:r?[{type:"video",url:r,label:"input"}]:void 0,extra:{mode:x,backgroundColor:b}}})]}):(0,i.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"Processed video will appear here."})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"small",style:{margin:"8px 0 6px"},children:"Log"}),(0,i.jsx)("pre",{className:"log",children:v.join("\n")})]})]}),(0,i.jsxs)("div",{className:"panel",children:[(0,i.jsx)("div",{className:"header",children:(0,i.jsx)("h3",{style:{margin:0},children:"Inputs (Replicate)"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"small",children:"Video file"}),(0,i.jsxs)("label",{className:"dnd",style:{display:"block"},children:[(0,i.jsx)("input",{type:"file",accept:"video/*",style:{display:"none"},onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&I(a)}}),t?(0,i.jsxs)("div",{className:"fileInfo",children:[(0,i.jsx)("span",{children:t.name}),(0,i.jsxs)("span",{children:["(",(t.size/1048576).toFixed(2)," MB)"]})]}):(0,i.jsx)("div",{className:"small",style:{color:"#b7c2df"},children:"Click to select a video"})]})]}),(0,i.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:12,marginTop:12},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"small",children:"mode"}),(0,i.jsxs)("select",{className:"select",value:x,onChange:e=>j(e.target.value),children:[(0,i.jsx)("option",{value:"Fast",children:"Fast"}),(0,i.jsx)("option",{value:"Normal",children:"Normal"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"small",children:"background_color"}),(0,i.jsx)("input",{className:"select",type:"text",value:b,onChange:e=>w(e.target.value),placeholder:"#FFFFFF"})]})]}),(0,i.jsx)("button",{className:"btn",style:{marginTop:12},disabled:!t||"processing"===u||"queued"===u,onClick:C,children:"processing"===u||"queued"===u?"Processing…":"Remove Background"})]})]})}},2277:function(e,t,a){"use strict";var i=a(7437),l=a(2265),s=a(1180);t.Z=function(e){let{mediaUrl:t,kind:a,context:n,size:r="default"}=e,[o,d]=(0,l.useState)(!1),[c,u]=(0,l.useState)(!1),[p,v]=(0,l.useState)(null),[f,m]=(0,l.useState)("idle");async function h(){if(t){d(!0),v(null),u(!1);try{var e,i;let{data:{user:l}}=await s._.auth.getUser();if(!l)throw Error("Please sign in at /auth to save assets.");let r=await s._.auth.getSession(),o=(null===(e=r.data.session)||void 0===e?void 0:e.access_token)||"";m("pending");let d=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?"Bearer ".concat(o):""},body:JSON.stringify({url:t,kind:a,context:n})});if(!d.ok)throw Error(await d.text());u(!0),m("indexing");try{let e=await d.json(),t=null==e?void 0:null===(i=e.asset)||void 0===i?void 0:i.id;if(t){let e=setInterval(async()=>{try{let{data:a}=await s._.from("media_assets").select("status").eq("id",t).single(),i=(null==a?void 0:a.status)||"pending";"ready"===i&&(m("ready"),clearInterval(e)),"error"===i&&(m("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else m("ready")}catch(e){m("ready")}}catch(e){v(e instanceof Error?e.message:"Failed to add to database")}finally{d(!1)}}}return(0,i.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,i.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:h,onKeyDown:e=>(function(e){let{event:t,onActivate:a}=e;("Enter"===t.key||" "===t.key)&&a()})({event:e,onActivate:h}),disabled:o,style:{padding:"large"===r?"12px 14px":"6px 10px",width:"large"===r?"100%":void 0,fontSize:"large"===r?16:void 0},children:o?"Saving to database…":c?"Saved ✓":"Save to database"}),"idle"!==f&&(0,i.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===f?"Pending":"indexing"===f?"Indexing":"ready"===f?"Ready":"error"===f?"Error":""}),p&&(0,i.jsx)("div",{className:"small",style:{color:"#ff7878"},children:p})]})}},1180:function(e,t,a){"use strict";a.d(t,{_:function(){return i}});let i=(0,a(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=1905)}),_N_E=e.O()}]);