(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[911],{441:function(e,l,a){Promise.resolve().then(a.bind(a,3653))},3653:function(e,l,a){"use strict";a.r(l),a.d(l,{default:function(){return t}});var s=a(7437);a(8877);var i=a(2265);function t(){let[e,l]=(0,i.useState)("https://www.facebook.com/drive4quantix/\nhttps://www.facebook.com/SHEINOFFICIAL/"),[a,t]=(0,i.useState)(99999),[n,r]=(0,i.useState)(!1),[d,o]=(0,i.useState)(!0),[c,u]=(0,i.useState)(""),[m,h]=(0,i.useState)(!1),[v,p]=(0,i.useState)("dress, summer"),[g,y]=(0,i.useState)("ALL"),[x,f]=(0,i.useState)(null),[j,N]=(0,i.useState)(null),[b,w]=(0,i.useState)(null),[I,_]=(0,i.useState)(!1),[k,S]=(0,i.useState)(null),[A,C]=(0,i.useState)([]),[T,U]=(0,i.useState)([]),[E,D]=(0,i.useState)(!0),[O,R]=(0,i.useState)("SHEIN"),[F,L]=(0,i.useState)([]),[P,B]=(0,i.useState)(!1),[z,H]=(0,i.useState)(""),[q,J]=(0,i.useState)(!1);async function W(e){try{let l=await fetch("/api/spy/scrape/results?datasetId=".concat(encodeURIComponent(e),"&limit=1000"));if(!l.ok)throw Error(await l.text());let a=await l.json();C(Array.isArray(a.items)?a.items:[]),U(function(e){let l=[];for(let o of e||[])for(let e of Array.isArray(null==o?void 0:o.results)?o.results:[]){var a,s,i,t,n,r,d;let c=(null==e?void 0:e.snapshot)||{},u=(Array.isArray(null==c?void 0:c.cards)?c.cards:[])[0]||{},m=(null==u?void 0:u.resizedImageUrl)||(null==u?void 0:u.originalImageUrl)||Array.isArray(null==c?void 0:c.images)&&c.images[0]||"",h=(null==u?void 0:u.title)||(null==c?void 0:c.title)||(null==e?void 0:e.ad_creative_link_title)||"",v=(null==c?void 0:null===(a=c.body)||void 0===a?void 0:a.text)||(null==e?void 0:e.ad_creative_body)||"",p=(null==e?void 0:e.publisherPlatform)||(null==e?void 0:e.publisher_platform)||(null==e?void 0:e.publisher_platforms)||[],g=(null==e?void 0:e.pageName)||(null==e?void 0:e.page_name)||(null==o?void 0:null===(t=o.pageInfo)||void 0===t?void 0:null===(i=t.adLibraryPageInfo)||void 0===i?void 0:null===(s=i.pageInfo)||void 0===s?void 0:s.pageName)||"",y=(null==e?void 0:e.pageId)||(null==e?void 0:e.page_id)||(null==o?void 0:null===(d=o.pageInfo)||void 0===d?void 0:null===(r=d.adLibraryPageInfo)||void 0===r?void 0:null===(n=r.pageInfo)||void 0===n?void 0:n.pageId)||"",x=(null==e?void 0:e.startDateFormatted)||(null==e?void 0:e.ad_delivery_start_time)||"",f=(null==e?void 0:e.endDateFormatted)||(null==e?void 0:e.ad_delivery_stop_time)||"",j=(null==e?void 0:e.adArchiveId)||(null==e?void 0:e.ad_archive_id)||(null==e?void 0:e.adArchiveID)||(null==e?void 0:e.id)||void 0,N=(null==u?void 0:u.ctaText)||(null==c?void 0:c.ctaText)||"",b=(null==u?void 0:u.linkUrl)||(null==c?void 0:c.linkUrl)||"";l.push({adId:j,pageName:g,pageId:y,platforms:Array.isArray(p)?p:p?[p]:[],title:h,bodyText:v,previewImage:m,ctaText:N,linkUrl:b,startIso:x,endIso:f,raw:e})}return l}(Array.isArray(a.items)?a.items:[]))}catch(e){S((null==e?void 0:e.message)||"Failed to fetch results")}}async function G(){_(!0),S(null),C([]),f(null),N(null),w(null);try{let l={startUrls:function(){if(m){let e=encodeURIComponent(v),l=encodeURIComponent(g||"ALL");return[{url:"https://www.facebook.com/ads/library/?active_status=all&ad_type=all&country=".concat(l,"&q=").concat(e,"&search_type=keyword_unordered&media_type=all&sort_data[direction]=desc&sort_data[mode]=relevancy_monthly_grouped"),method:"GET"}]}return e.split(/\n|,/).map(e=>e.trim()).filter(Boolean).map(e=>({url:e,method:"GET"}))}(),resultsLimit:a,onlyTotal:n,isDetailsPerAd:d,activeStatus:c},s=await fetch("/api/spy/scrape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!s.ok)throw Error(await s.text());let i=await s.json();f(i.runId||null),N(i.defaultDatasetId||null),w(i.status||null)}catch(e){S((null==e?void 0:e.message)||"Failed to start scrape")}finally{_(!1)}}async function K(){B(!0),S(null);try{let e=await fetch("/api/spy/python/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:O})});if(!e.ok)throw Error(await e.text());let l=await e.json();L(Array.isArray(l.pages)?l.pages:[])}catch(e){S((null==e?void 0:e.message)||"Search failed")}finally{B(!1)}}async function M(e){J(!0),S(null),U([]);try{let l=await fetch("/api/spy/python/ads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pageId:e})});if(!l.ok)throw Error(await l.text());let a=await l.json(),s=Array.isArray(a.ads)?a.ads:[];U(function(e){let l=[];for(let r of e||[]){var a,s,i,t,n;let e=(null==r?void 0:r.snapshot)||{},d=(Array.isArray(null==e?void 0:e.cards)?e.cards:[])[0]||{},o=(null==d?void 0:d.resized_image_url)||(null==d?void 0:d.resizedImageUrl)||(null==d?void 0:d.originalImageUrl)||(null==d?void 0:d.original_image_url),c=Array.isArray(null==e?void 0:e.images)&&e.images.length>0?(null===(a=e.images[0])||void 0===a?void 0:a.resized_image_url)||(null===(s=e.images[0])||void 0===s?void 0:s.resizedImageUrl)||(null===(i=e.images[0])||void 0===i?void 0:i.originalImageUrl)||(null===(t=e.images[0])||void 0===t?void 0:t.original_image_url):"",u=o||c||"",m=(null==d?void 0:d.title)||(null==e?void 0:e.title)||(null==r?void 0:r.ad_creative_link_title)||"",h="string"==typeof(null==e?void 0:e.body)?e.body:(null==e?void 0:null===(n=e.body)||void 0===n?void 0:n.text)||(null==r?void 0:r.ad_creative_body)||"",v=(null==r?void 0:r.publisher_platforms)||(null==r?void 0:r.publisher_platform)||[],p=(null==r?void 0:r.page_name)||"",g=(null==r?void 0:r.page_id)||"",y=(null==r?void 0:r.ad_delivery_start_time)||(null==r?void 0:r.ad_creation_time)||"",x=(null==r?void 0:r.ad_delivery_stop_time)||"",f=(null==r?void 0:r.ad_archive_id)||(null==r?void 0:r.id)||void 0,j=(null==d?void 0:d.cta_text)||(null==d?void 0:d.ctaText)||(null==e?void 0:e.ctaText)||"",N=(null==d?void 0:d.link_url)||(null==d?void 0:d.linkUrl)||(null==e?void 0:e.linkUrl)||"";l.push({adId:f,pageName:p,pageId:g,platforms:Array.isArray(v)?v:v?[v]:[],title:m,bodyText:h,previewImage:u,ctaText:j,linkUrl:N,startIso:y,endIso:x,raw:r})}return l}(s))}catch(e){S((null==e?void 0:e.message)||"Fetch ads failed")}finally{J(!1)}}return(0,i.useEffect)(()=>{let e;async function l(){if(x){try{let e=await fetch("/api/spy/scrape/status?runId=".concat(encodeURIComponent(x)));if(!e.ok)throw Error(await e.text());let l=await e.json();w(l.status||null),l.defaultDatasetId&&N(l.defaultDatasetId);let a=l.status;if("SUCCEEDED"===a){l.defaultDatasetId&&await W(l.defaultDatasetId);return}if(["FAILED","TIMED-OUT","ABORTED"].includes(a)){S("Run ".concat(a,". Check Apify run logs."));return}}catch(e){S((null==e?void 0:e.message)||"Polling failed")}e=setTimeout(l,3e3)}}return l(),()=>{e&&clearTimeout(e)}},[x]),(0,s.jsxs)("div",{className:"container",style:{gridTemplateColumns:"1fr"},children:[(0,s.jsxs)("div",{className:"panel",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h2",{style:{margin:0},children:"Facebook Page Ads Scraper"}),(0,s.jsx)("span",{className:"badge",children:E?"Built-in":"Apify"})]}),(0,s.jsxs)("div",{className:"options",style:{marginBottom:12},children:[(0,s.jsx)("div",{className:"row",style:{gap:16,alignItems:"center",marginBottom:8},children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:E,onChange:e=>D(e.target.checked)})," Use built-in free scraper"]})}),E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"row",style:{gap:8},children:[(0,s.jsxs)("div",{style:{flex:2},children:[(0,s.jsx)("div",{className:"small",children:"Search pages by name"}),(0,s.jsx)("input",{className:"input",value:O,onChange:e=>R(e.target.value),placeholder:"e.g. SHEIN"})]}),(0,s.jsx)("div",{style:{display:"flex",alignItems:"flex-end"},children:(0,s.jsx)("button",{className:"btn",onClick:K,disabled:P,children:"Search Pages"})})]}),F.length>0&&(0,s.jsxs)("div",{className:"panel",style:{marginTop:8},children:[(0,s.jsxs)("div",{className:"small",style:{marginBottom:4},children:["Results (",F.length,") — click to load ads"]}),(0,s.jsx)("div",{style:{display:"grid",gap:6},children:F.map(e=>(0,s.jsxs)("button",{className:"select",onClick:()=>{H(e.id),M(e.id)},children:[e.name," \xb7 ",e.id]},e.id))})]}),(0,s.jsxs)("div",{className:"row",style:{gap:8,marginTop:8},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("div",{className:"small",children:"Or enter Page ID"}),(0,s.jsx)("input",{className:"input",value:z,onChange:e=>H(e.target.value),placeholder:"380039845369159"})]}),(0,s.jsx)("div",{style:{display:"flex",alignItems:"flex-end"},children:(0,s.jsx)("button",{className:"btn",onClick:()=>z&&M(z),disabled:q||!z,children:"Load Ads"})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"row",style:{gap:16,alignItems:"center",marginBottom:8},children:(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:m,onChange:e=>h(e.target.checked)})," Search by keywords instead of URLs"]})}),m?(0,s.jsxs)("div",{className:"row",style:{gap:8},children:[(0,s.jsxs)("div",{style:{flex:2},children:[(0,s.jsx)("div",{className:"small",children:"Keywords (comma-separated)"}),(0,s.jsx)("input",{className:"input",value:v,onChange:e=>p(e.target.value),placeholder:"e.g. shoes, running"})]}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("div",{className:"small",children:"Country"}),(0,s.jsx)("input",{className:"input",value:g,onChange:e=>y(e.target.value.toUpperCase()),placeholder:"ALL or ISO code, e.g. US"})]})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"small",children:"Start URLs (one per line or comma-separated)"}),(0,s.jsx)("textarea",{className:"input",style:{minHeight:96},value:e,onChange:e=>l(e.target.value),placeholder:"https://www.facebook.com/drive4quantix/\nhttps://www.facebook.com/SHEINOFFICIAL/"})]}),(0,s.jsxs)("div",{className:"row",style:{gap:8},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("div",{className:"small",children:"Results limit"}),(0,s.jsx)("input",{className:"input",type:"number",value:a,onChange:e=>t(Number(e.target.value)||0)})]}),(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("div",{className:"small",children:"Active status"}),(0,s.jsxs)("select",{className:"select",value:c,onChange:e=>u(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Not specified"}),(0,s.jsx)("option",{value:"active",children:"active"}),(0,s.jsx)("option",{value:"inactive",children:"inactive"})]})]})]}),(0,s.jsxs)("div",{className:"row",style:{gap:16,alignItems:"center"},children:[(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:n,onChange:e=>r(e.target.checked)})," onlyTotal"]}),(0,s.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,s.jsx)("input",{type:"checkbox",checked:d,onChange:e=>o(e.target.checked)})," isDetailsPerAd"]})]})]})]}),!E&&(0,s.jsx)("div",{style:{display:"flex",gap:8},children:(0,s.jsx)("button",{className:"btn",onClick:G,disabled:I,children:"Save & Start"})}),k&&(0,s.jsx)("div",{className:"small",style:{color:"#ff6b6b",marginTop:8},children:k}),!E&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"kv",style:{marginTop:12},children:[(0,s.jsx)("div",{children:"Run ID"}),(0,s.jsx)("div",{className:"small",children:x||"—"}),(0,s.jsx)("div",{children:"Status"}),(0,s.jsx)("div",{className:"small",children:b||"—"}),(0,s.jsx)("div",{children:"Dataset ID"}),(0,s.jsx)("div",{className:"small",children:j||"—"})]}),(x||j)&&(0,s.jsxs)("div",{className:"row",style:{gap:8,marginTop:8},children:[x&&(0,s.jsx)("a",{className:"btn",href:"https://console.apify.com/actors/runs/".concat(encodeURIComponent(x)),target:"_blank",rel:"noreferrer",children:"Open run in Apify"}),j&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("a",{className:"select",href:"https://console.apify.com/storage/datasets/".concat(encodeURIComponent(j)),target:"_blank",rel:"noreferrer",children:"Open dataset"}),(0,s.jsx)("button",{className:"select",onClick:()=>W(j),children:"Refresh results"})]})]})]})]}),(0,s.jsxs)("div",{className:"panel",style:{marginTop:12},children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h3",{style:{margin:0},children:"Results"}),(0,s.jsx)("span",{className:"badge",children:T.length})]}),0===T.length?(0,s.jsx)("div",{className:"small",children:!E&&x?b?"Waiting for results… (".concat(b,")"):"Starting…":"No results yet"}):(0,s.jsx)("div",{style:{display:"grid",gap:8},children:T.map((e,l)=>(0,s.jsxs)("details",{className:"panel",style:{padding:12},children:[(0,s.jsx)("summary",{style:{cursor:"pointer"},children:(0,s.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[(0,s.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,s.jsx)("div",{style:{fontWeight:700},children:e.pageName||"Unknown Page"}),(0,s.jsx)("div",{className:"small",style:{opacity:.8},children:e.title||"—"})]}),(0,s.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:(0,s.jsxs)("span",{className:"badge",children:[(e.startIso||"").slice(0,10)," → ",(e.endIso||"").slice(0,10)||"now"]})})]}),e.previewImage&&(0,s.jsx)("div",{style:{width:"100%",overflow:"hidden",borderRadius:8,border:"1px solid rgba(255,255,255,0.08)"},children:(0,s.jsx)("img",{src:e.previewImage,alt:e.title||"creative",style:{display:"block",width:"100%",height:"auto"}})}),(0,s.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:[Array.isArray(e.platforms)&&e.platforms.map(e=>(0,s.jsx)("span",{className:"badge",children:e},e)),e.ctaText&&(0,s.jsx)("span",{className:"badge",children:e.ctaText})]})]})}),(0,s.jsxs)("div",{style:{marginTop:8},children:[(0,s.jsx)("div",{className:"small",style:{marginBottom:4},children:"Primary text"}),(0,s.jsx)("pre",{className:"log",style:{whiteSpace:"pre-wrap"},children:e.bodyText||"—"})]}),(0,s.jsxs)("div",{className:"kv",style:{marginTop:8},children:[(0,s.jsx)("div",{children:"Page"}),(0,s.jsxs)("div",{className:"small",children:[e.pageId," • ",e.pageName]}),(0,s.jsx)("div",{children:"CTA"}),(0,s.jsx)("div",{className:"small",children:e.ctaText||"—"}),(0,s.jsx)("div",{children:"Link"}),(0,s.jsx)("div",{className:"small",children:e.linkUrl?(0,s.jsx)("a",{href:e.linkUrl,target:"_blank",rel:"noreferrer",children:e.linkUrl}):"—"}),(0,s.jsx)("div",{children:"Ad ID"}),(0,s.jsx)("div",{className:"small",children:e.adId||"—"})]}),(0,s.jsxs)("div",{style:{marginTop:8},children:[(0,s.jsx)("div",{className:"small",style:{marginBottom:4},children:"All fields"}),(0,s.jsx)("pre",{className:"log",style:{whiteSpace:"pre-wrap"},children:JSON.stringify(e.raw,null,2)})]})]},e.adId||l))})]})]})}},8877:function(){}},function(e){e.O(0,[404,971,23,744],function(){return e(e.s=441)}),_N_E=e.O()}]);