(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{3416:function(e,a,t){Promise.resolve().then(t.bind(t,161))},161:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return r}});var l=t(7437);t(8877);var i=t(2265),s=t(1180),n=t(2277);function r(){let[e,a]=(0,i.useState)("google/veo-3-fast"),[t,r]=(0,i.useState)("A cinematic drone flyover of futuristic cityscapes at sunset."),[d,o]=(0,i.useState)(""),[c,u]=(0,i.useState)(""),[p,m]=(0,i.useState)("720p"),[v,h]=(0,i.useState)(""),[g,f]=(0,i.useState)(""),[x,y]=(0,i.useState)(""),[j,N]=(0,i.useState)(!1),[b,w]=(0,i.useState)(!1),[S,k]=(0,i.useState)(!1),[C,D]=(0,i.useState)(!1),[T,I]=(0,i.useState)(null),[O,_]=(0,i.useState)(null),[E,R]=(0,i.useState)(null),[F,P]=(0,i.useState)(null),[W,U]=(0,i.useState)(!1),[A,J]=(0,i.useState)(null),[G,B]=(0,i.useState)(null),[M,V]=(0,i.useState)({}),Z=(0,i.useCallback)(async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let t=await fetch("/api/upload",{method:"POST",body:a});if(!t.ok)throw Error(await t.text());return(await t.json()).url},[]),q=(0,i.useCallback)(async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let t=await fetch("/api/upload",{method:"POST",body:a});if(!t.ok)throw Error(await t.text());return(await t.json()).url},[]);(0,i.useEffect)(()=>{(async()=>{U(!0),J(null),B(null),V({});try{let a=await fetch("/api/replicate/schema?model=".concat(encodeURIComponent(e)),{cache:"no-store"});if(!a.ok)throw Error(await a.text());let t=await a.json();B(t.input||null)}catch(e){J((null==e?void 0:e.message)||"Failed to load schema")}finally{U(!1)}})()},[e]);let z=(0,i.useMemo)(()=>{if(!(null==G?void 0:G.properties))return[];let e=[];for(let[a,t]of Object.entries(G.properties))"prompt"!==a&&(null==t?void 0:t.format)==="uri"&&e.push(a);return e},[G]),L=(0,i.useMemo)(()=>{if(!(null==G?void 0:G.properties))return[];let e=[];for(let[a,t]of Object.entries(G.properties))"prompt"!==a&&(null==t?void 0:t.format)!=="uri"&&e.push({key:a,schema:t});return e},[G]);async function X(e){try{let a=await fetch("/api/persist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,filename:e.split("/").pop()||null,folder:"veo"})});if(!a.ok)return e;let t=await a.json();return"string"==typeof(null==t?void 0:t.url)?t.url:e}catch(a){return e}}async function Q(){D(!0),I(null),_(null);try{let{data:{user:a}}=await s._.auth.getUser();if(!a)throw Error("Please sign in at /auth before creating a task.");let l=e.startsWith("google/veo"),i={...M};if(l&&(d&&(i.image=d),c&&(i.negative_prompt=c),i.resolution=p,""!==v.trim()&&(i.seed=Number(v)),g&&(i.start_frame=g),x&&(i.end_frame=x)),(null==G?void 0:G.properties)&&"object"==typeof G.properties)for(let[e,a]of Object.entries(G.properties)){if(!(e in i))continue;let t=i[e];if(null==t||""===t)continue;let l=null==a?void 0:a.type,s=Array.isArray(null==a?void 0:a.enum)&&a.enum.length>0&&"number"==typeof a.enum[0];if("integer"===l||s&&Number.isInteger(Number(t))){let a=parseInt(String(t));Number.isNaN(a)||(i[e]=a)}else if("number"===l||s&&!Number.isInteger(Number(t))){let a=parseFloat(String(t));Number.isNaN(a)||(i[e]=a)}}let n={model:e,...i},{data:r,error:o}=await s._.from("tasks").insert({user_id:a.id,type:"lipsync",status:"queued",provider:"replicate",model_id:e,options_json:n,text_input:t}).select("*").single();if(o||!r)throw Error((null==o?void 0:o.message)||"Failed to create task");P(r.id);let u=await fetch("/api/veo/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:e,prompt:t,input:i})});if(!u.ok)throw Error(await u.text());let m=await u.json();if(!m.url)throw Error("No video URL returned");let h=await X(m.url),f="/api/proxy?type=video&url=".concat(encodeURIComponent(h));R(h),_(f),(null==r?void 0:r.id)&&await s._.from("tasks").update({status:"finished",output_url:h}).eq("id",r.id)}catch(e){I((null==e?void 0:e.message)||"Failed to generate video"),F&&await s._.from("tasks").update({status:"error"}).eq("id",F)}finally{D(!1)}}return(0,l.jsxs)("div",{className:"container",children:[(0,l.jsxs)("div",{className:"panel output",children:[(0,l.jsx)("div",{className:"header",children:(0,l.jsx)("h2",{style:{margin:0},children:"Output"})}),(0,l.jsx)("div",{className:"outputArea",children:O?(0,l.jsxs)("div",{children:[(0,l.jsxs)("video",{controls:!0,preload:"metadata",playsInline:!0,style:{width:"100%",borderRadius:8},onError:()=>I("Failed to load video. Try the direct link below."),children:[(0,l.jsx)("source",{src:O,type:"video/mp4"}),E&&E!==O?(0,l.jsx)("source",{src:E}):null]}),(0,l.jsxs)("div",{className:"small",style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap",justifyContent:"center"},children:[(0,l.jsx)("a",{href:O,target:"_blank",rel:"noreferrer",style:{padding:"8px 12px",background:"var(--panel-elevated)",borderRadius:"6px",textDecoration:"none"},children:"Open via proxy"}),E?(0,l.jsx)("a",{href:E,target:"_blank",rel:"noreferrer",style:{padding:"8px 12px",background:"var(--panel-elevated)",borderRadius:"6px",textDecoration:"none"},children:"Open direct"}):null,(0,l.jsx)("a",{href:"".concat(O).concat(O.includes("?")?"&":"?","download=true"),style:{padding:"8px 12px",background:"var(--accent)",color:"white",borderRadius:"6px",textDecoration:"none"},children:"Download"})]}),(0,l.jsx)(n.Z,{mediaUrl:E||O,kind:"video",size:"large",context:{prompt:t,model:e,inputs:[d?{type:"image",url:d,label:"reference_image"}:void 0,g?{type:"image",url:g,label:"start_frame"}:void 0,x?{type:"image",url:x,label:"end_frame"}:void 0].filter(Boolean)}})]}):(0,l.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"Generated video will appear here."})}),T&&(0,l.jsx)("div",{className:"small",style:{color:"#ff7878"},children:T})]}),(0,l.jsxs)("div",{className:"panel",children:[(0,l.jsxs)("div",{className:"header",children:[(0,l.jsx)("h3",{style:{margin:0},children:"Video Generation"}),(0,l.jsx)("span",{className:"badge",children:"AI Video Models"})]}),(0,l.jsx)("div",{className:"options",children:(0,l.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,l.jsx)("div",{className:"small",children:"Model"}),(0,l.jsxs)("select",{className:"select",value:e,onChange:e=>a(e.target.value),children:[(0,l.jsx)("option",{value:"google/veo-3-fast",children:"Google VEO 3 Fast (Recommended)"}),(0,l.jsx)("option",{value:"google/veo-3",children:"Google VEO 3 (Highest Quality)"}),(0,l.jsx)("option",{value:"bytedance/seedance-1-pro",children:"ByteDance Seedance 1 Pro"}),(0,l.jsx)("option",{value:"bytedance/seedance-1-lite",children:"ByteDance Seedance 1 Lite"})]})]})}),(0,l.jsx)("div",{className:"options",children:(0,l.jsxs)("div",{style:{gridColumn:"span 2"},children:[(0,l.jsx)("div",{className:"small",children:"Video Prompt"}),(0,l.jsx)("textarea",{className:"input",value:t,onChange:e=>r(e.target.value),rows:4,placeholder:"Describe the video you want to generate in detail..."})]})}),e.startsWith("google/veo")&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:"Reference image (optional)"}),(0,l.jsxs)("div",{className:"dnd ".concat(j?"drag":""),onDragOver:e=>{e.preventDefault(),N(!0)},onDragLeave:e=>{e.preventDefault(),N(!1)},onDrop:async e=>{var a;e.preventDefault(),N(!1);let t=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];if(t&&t.type.startsWith("image/"))try{let e=await Z(t);o(e)}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=async()=>{var a;let t=(null===(a=e.files)||void 0===a?void 0:a[0])||null;if(t)try{let e=await Z(t);o(e)}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},e.click()},children:[(0,l.jsx)("div",{className:"dnd-icon",children:"\uD83D\uDDBC️"}),(0,l.jsx)("div",{className:"dnd-title",children:"Reference Image"}),(0,l.jsx)("div",{className:"dnd-subtitle",children:"PNG/JPG • ideal 1280x720"}),d&&(0,l.jsxs)("div",{className:"fileInfo",style:{marginTop:"var(--space-3)"},children:[(0,l.jsx)("img",{src:d,alt:"reference",style:{maxWidth:240,borderRadius:"var(--radius-lg)"}}),(0,l.jsx)("div",{className:"small",style:{marginTop:"var(--space-2)"},children:(0,l.jsx)("a",{href:d,target:"_blank",rel:"noreferrer",children:"Open image"})})]})]}),d&&(0,l.jsx)("button",{className:"btn",style:{marginTop:8},onClick:()=>o(""),children:"Clear image"})]}),(0,l.jsxs)("div",{className:"options",style:{marginTop:12},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:"Start frame (optional)"}),(0,l.jsxs)("div",{className:"dnd ".concat(b?"drag":""),onDragOver:e=>{e.preventDefault(),w(!0)},onDragLeave:e=>{e.preventDefault(),w(!1)},onDrop:async e=>{var a;e.preventDefault(),w(!1);let t=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];if(t&&t.type.startsWith("image/"))try{let e=await Z(t);f(e)}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=async()=>{var a;let t=(null===(a=e.files)||void 0===a?void 0:a[0])||null;if(t)try{let e=await Z(t);f(e)}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},e.click()},children:[(0,l.jsx)("div",{className:"dnd-icon",children:"\uD83C\uDFAC"}),(0,l.jsx)("div",{className:"dnd-title",children:"Start Frame"}),(0,l.jsx)("div",{className:"dnd-subtitle",children:"PNG/JPG"}),g&&(0,l.jsxs)("div",{className:"fileInfo",style:{marginTop:"var(--space-3)"},children:[(0,l.jsx)("img",{src:g,alt:"start",style:{maxWidth:240,borderRadius:"var(--radius-lg)"}}),(0,l.jsx)("div",{className:"small",style:{marginTop:"var(--space-2)"},children:(0,l.jsx)("a",{href:g,target:"_blank",rel:"noreferrer",children:"Open start"})})]})]}),g&&(0,l.jsx)("button",{className:"btn",style:{marginTop:8},onClick:()=>f(""),children:"Clear start"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:"End frame (optional)"}),(0,l.jsxs)("div",{className:"dnd ".concat(S?"drag":""),onDragOver:e=>{e.preventDefault(),k(!0)},onDragLeave:e=>{e.preventDefault(),k(!1)},onDrop:async e=>{var a;e.preventDefault(),k(!1);let t=null===(a=e.dataTransfer.files)||void 0===a?void 0:a[0];if(t&&t.type.startsWith("image/"))try{let e=await Z(t);y(e)}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=async()=>{var a;let t=(null===(a=e.files)||void 0===a?void 0:a[0])||null;if(t)try{let e=await Z(t);y(e)}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},e.click()},children:[(0,l.jsx)("div",{className:"dnd-icon",children:"\uD83C\uDFC1"}),(0,l.jsx)("div",{className:"dnd-title",children:"End Frame"}),(0,l.jsx)("div",{className:"dnd-subtitle",children:"PNG/JPG"}),x&&(0,l.jsxs)("div",{className:"fileInfo",style:{marginTop:"var(--space-3)"},children:[(0,l.jsx)("img",{src:x,alt:"end",style:{maxWidth:240,borderRadius:"var(--radius-lg)"}}),(0,l.jsx)("div",{className:"small",style:{marginTop:"var(--space-2)"},children:(0,l.jsx)("a",{href:x,target:"_blank",rel:"noreferrer",children:"Open end"})})]})]}),x&&(0,l.jsx)("button",{className:"btn",style:{marginTop:8},onClick:()=>y(""),children:"Clear end"})]})]})]}),W?(0,l.jsx)("div",{className:"small",style:{marginTop:8},children:"Loading model schema…"}):A?(0,l.jsx)("div",{className:"small",style:{color:"#ff7878",marginTop:8},children:A}):G?(0,l.jsxs)(l.Fragment,{children:[z.length>0&&(0,l.jsxs)("div",{className:"options",style:{marginTop:12},children:[(0,l.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Reference media"}),z.map(e=>(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:e}),(0,l.jsxs)("div",{className:"dnd",onDragOver:e=>{e.preventDefault()},onDrop:async a=>{var t;a.preventDefault();let l=null===(t=a.dataTransfer.files)||void 0===t?void 0:t[0];if(l)try{let a=await q(l);V(t=>({...t,[e]:a}))}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},onClick:()=>{let a=document.createElement("input");a.type="file",a.accept="image/*,video/*",a.onchange=async()=>{var t;let l=(null===(t=a.files)||void 0===t?void 0:t[0])||null;if(l)try{let a=await q(l);V(t=>({...t,[e]:a}))}catch(e){I((null==e?void 0:e.message)||"Upload failed")}},a.click()},children:[(0,l.jsx)("div",{className:"dnd-icon",children:"\uD83D\uDCCE"}),(0,l.jsx)("div",{className:"dnd-title",children:e}),(0,l.jsx)("div",{className:"dnd-subtitle",children:"Image/Video • Auto-configured"}),M[e]&&(0,l.jsxs)("div",{className:"fileInfo",style:{marginTop:"var(--space-3)"},children:[String(M[e]).match(/\.(mp4|mov|webm)(\?|$)/i)?(0,l.jsx)("video",{src:M[e],controls:!0,style:{maxWidth:240,borderRadius:"var(--radius-lg)"}}):(0,l.jsx)("img",{src:M[e],alt:e,style:{maxWidth:240,borderRadius:"var(--radius-lg)"}}),(0,l.jsx)("div",{className:"small",style:{marginTop:"var(--space-2)"},children:(0,l.jsx)("a",{href:M[e],target:"_blank",rel:"noreferrer",children:"Open"})})]})]}),M[e]&&(0,l.jsxs)("button",{className:"btn",style:{marginTop:8},onClick:()=>V(a=>{let t={...a};return delete t[e],t}),children:["Clear ",e]})]},e))]}),L.length>0&&(0,l.jsxs)("div",{className:"options",style:{marginTop:12},children:[(0,l.jsx)("div",{style:{fontWeight:700,marginBottom:6},children:"Model parameters"}),L.map(e=>{var a,t,i,s,n,r;let{key:d,schema:o}=e,c=Array.isArray(null==G?void 0:G.required)&&G.required.includes(d),u=(null==o?void 0:o.title)||d;if(Array.isArray(null==o?void 0:o.enum)){let e=(null==o?void 0:o.type)==="integer"||(null==o?void 0:o.type)==="number";return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"small",children:[u,c?" *":""]}),(0,l.jsx)("select",{className:"select",value:null!==(t=null!==(a=M[d])&&void 0!==a?a:o.default)&&void 0!==t?t:"",onChange:a=>{let t=a.target.value;V(a=>({...a,[d]:e?(null==o?void 0:o.type)==="integer"?parseInt(t):parseFloat(t):t}))},children:o.enum.map(e=>{let a=String(e),t=String(e);return(0,l.jsx)("option",{value:t,children:a},a)})})]},d)}if((null==o?void 0:o.type)==="integer"||(null==o?void 0:o.type)==="number"){let e=(null==o?void 0:o.type)==="integer"?1:(null==o?void 0:o.multipleOf)||.1;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"small",children:[u,c?" *":""]}),(0,l.jsx)("input",{className:"input",type:"number",step:e,min:null!==(i=null==o?void 0:o.minimum)&&void 0!==i?i:void 0,max:null!==(s=null==o?void 0:o.maximum)&&void 0!==s?s:void 0,value:null!==(n=M[d])&&void 0!==n?n:"",onChange:e=>{let a=e.target.value;V(e=>({...e,[d]:""===a?void 0:(null==o?void 0:o.type)==="integer"?parseInt(a):parseFloat(a)}))},placeholder:(null==o?void 0:o.description)||""})]},d)}return(null==o?void 0:o.type)==="boolean"?(0,l.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,l.jsx)("input",{type:"checkbox",checked:!!M[d],onChange:e=>V(a=>({...a,[d]:e.target.checked}))})," ",u,c?" *":""]},d):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"small",children:[u,c?" *":""]}),(0,l.jsx)("input",{className:"input",value:null!==(r=M[d])&&void 0!==r?r:"",onChange:e=>V(a=>({...a,[d]:e.target.value})),placeholder:(null==o?void 0:o.description)||""})]},d)})]})]}):null,e.startsWith("google/veo")&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:"Negative Prompt (optional)"}),(0,l.jsx)("textarea",{className:"input",value:c,onChange:e=>u(e.target.value),rows:3,placeholder:"Things to avoid in the video"})]}),e.startsWith("google/veo")&&(0,l.jsxs)("div",{className:"options",style:{marginTop:12},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:"Resolution"}),(0,l.jsxs)("select",{className:"select",value:p,onChange:e=>m(e.target.value),children:[(0,l.jsx)("option",{value:"720p",children:"720p"}),(0,l.jsx)("option",{value:"1080p",children:"1080p"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"small",children:"Seed (optional)"}),(0,l.jsx)("input",{className:"input",type:"number",value:v,onChange:e=>h(e.target.value),placeholder:"Random if empty"})]})]}),(0,l.jsx)("button",{className:"btn",style:{marginTop:12},disabled:!t.trim()||C,onClick:Q,children:C?"Generating…":"Generate video"})]})]})}},2277:function(e,a,t){"use strict";var l=t(7437),i=t(2265),s=t(1180);a.Z=function(e){let{mediaUrl:a,kind:t,context:n,size:r="default"}=e,[d,o]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),[p,m]=(0,i.useState)(null),[v,h]=(0,i.useState)("idle");async function g(){if(a){o(!0),m(null),u(!1);try{var e,l;let{data:{user:i}}=await s._.auth.getUser();if(!i)throw Error("Please sign in at /auth to save assets.");let r=await s._.auth.getSession(),d=(null===(e=r.data.session)||void 0===e?void 0:e.access_token)||"";h("pending");let o=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:d?"Bearer ".concat(d):""},body:JSON.stringify({url:a,kind:t,context:n})});if(!o.ok)throw Error(await o.text());u(!0),h("indexing");try{let e=await o.json(),a=null==e?void 0:null===(l=e.asset)||void 0===l?void 0:l.id;if(a){let e=setInterval(async()=>{try{let{data:t}=await s._.from("media_assets").select("status").eq("id",a).single(),l=(null==t?void 0:t.status)||"pending";"ready"===l&&(h("ready"),clearInterval(e)),"error"===l&&(h("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else h("ready")}catch(e){h("ready")}}catch(e){m(e instanceof Error?e.message:"Failed to add to database")}finally{o(!1)}}}return(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,l.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:g,onKeyDown:e=>(function(e){let{event:a,onActivate:t}=e;("Enter"===a.key||" "===a.key)&&t()})({event:e,onActivate:g}),disabled:d,style:{padding:"large"===r?"12px 14px":"6px 10px",width:"large"===r?"100%":void 0,fontSize:"large"===r?16:void 0},children:d?"Saving to database…":c?"Saved ✓":"Save to database"}),"idle"!==v&&(0,l.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===v?"Pending":"indexing"===v?"Indexing":"ready"===v?"Ready":"error"===v?"Error":""}),p&&(0,l.jsx)("div",{className:"small",style:{color:"#ff7878"},children:p})]})}},1180:function(e,a,t){"use strict";t.d(a,{_:function(){return l}});let l=(0,t(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=3416)}),_N_E=e.O()}]);