(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[268],{4206:function(e,a,t){Promise.resolve().then(t.bind(t,2060))},2060:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return r}});var n=t(7437);t(8877);var s=t(2265),i=t(1180),l=t(2277);function r(){let[e,a]=(0,s.useState)(""),[t,r]=(0,s.useState)(!1),[o,c]=(0,s.useState)("Low Resolution V2"),[d,u]=(0,s.useState)("4x"),[h,p]=(0,s.useState)(!0),[m,f]=(0,s.useState)("Foreground"),[g,v]=(0,s.useState)(.5),[x,y]=(0,s.useState)(!1),[j,b]=(0,s.useState)(null),[w,N]=(0,s.useState)(null),[k,S]=(0,s.useState)(null),_=(0,s.useCallback)(async e=>{let a=new FormData;a.append("file",e),a.append("filename",e.name);let t=await fetch("/api/upload",{method:"POST",body:a});if(!t.ok)throw Error(await t.text());return(await t.json()).url},[]);async function I(e){try{let a=await fetch("/api/persist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e,filename:e.split("/").pop()||null,folder:"enhance"})});if(!a.ok)return e;let t=await a.json();return"string"==typeof(null==t?void 0:t.url)?t.url:e}catch(a){return e}}async function C(){y(!0),b(null),N(null);try{let{data:{user:a}}=await i._.auth.getUser();if(!a)throw Error("Please sign in at /auth before creating a task.");let t={image:e,enhance_model:o,upscale_factor:d,face_enhancement:h,subject_detection:m,face_enhancement_creativity:g},{data:n,error:s}=await i._.from("tasks").insert({user_id:a.id,type:"lipsync",status:"queued",provider:"replicate",model_id:"topazlabs/image-upscale",options_json:t,text_input:"enhance"}).select("*").single();if(s||!n)throw Error((null==s?void 0:s.message)||"Failed to create task");S(n.id);let l=await fetch("/api/enhance/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!l.ok)throw Error(await l.text());let r=await l.json();if(!r.url)throw Error("No image URL returned");let c=await I(r.url);N(c),(null==n?void 0:n.id)&&await i._.from("tasks").update({status:"finished",output_url:c}).eq("id",n.id)}catch(e){b((null==e?void 0:e.message)||"Failed to enhance image"),k&&await i._.from("tasks").update({status:"error"}).eq("id",k)}finally{y(!1)}}return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsxs)("div",{className:"panel output",children:[(0,n.jsx)("div",{className:"header",children:(0,n.jsx)("h2",{style:{margin:0},children:"Output"})}),(0,n.jsx)("div",{className:"outputArea",children:w?(0,n.jsxs)("div",{children:[(0,n.jsx)("img",{src:w,style:{maxWidth:"100%",borderRadius:8}}),(0,n.jsx)(l.Z,{mediaUrl:w,kind:"image",size:"large",context:{model:"topazlabs/image-upscale",prompt:"enhance",inputs:e?[{type:"image",url:e,label:"input"}]:void 0,extra:{enhance_model:o,upscale_factor:d,face_enhancement:h,subject_detection:m}}})]}):(0,n.jsx)("div",{style:{fontSize:16,color:"#b7c2df"},children:"Enhanced image will appear here."})}),j&&(0,n.jsx)("div",{className:"small",style:{color:"#ff7878"},children:j})]}),(0,n.jsxs)("div",{className:"panel",children:[(0,n.jsx)("div",{className:"header",children:(0,n.jsx)("h3",{style:{margin:0},children:"Inputs"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"small",children:"Input image"}),(0,n.jsxs)("div",{className:"dnd ".concat(t?"drag":""),onDragOver:e=>{e.preventDefault(),r(!0)},onDragLeave:e=>{e.preventDefault(),r(!1)},onDrop:async e=>{e.preventDefault(),r(!1);let t=Array.from(e.dataTransfer.files||[]).filter(e=>e.type.startsWith("image/"));if(t.length)try{let e=await _(t[0]);a(e)}catch(e){b((null==e?void 0:e.message)||"Upload failed")}},onClick:()=>{let e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=async()=>{let t=Array.from(e.files||[]);if(t.length)try{let e=await _(t[0]);a(e)}catch(e){b((null==e?void 0:e.message)||"Upload failed")}},e.click()},children:[(0,n.jsx)("div",{style:{fontWeight:700},children:"Drop image or click to upload"}),(0,n.jsx)("div",{className:"small",children:"PNG/JPG/WebP"}),e&&(0,n.jsxs)("div",{className:"fileInfo",style:{marginTop:8},children:[(0,n.jsx)("img",{src:e,alt:"input",style:{maxWidth:240,borderRadius:8}}),(0,n.jsx)("div",{className:"small",style:{marginTop:6},children:(0,n.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:"Open image"})})]})]}),e&&(0,n.jsx)("button",{className:"btn",style:{marginTop:8},onClick:()=>a(""),children:"Clear image"})]}),(0,n.jsxs)("div",{className:"options",style:{marginTop:12},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"small",children:"Enhance model"}),(0,n.jsx)("input",{className:"input",value:o,onChange:e=>c(e.target.value),placeholder:"Low Resolution V2"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"small",children:"Upscale factor"}),(0,n.jsxs)("select",{className:"select",value:d,onChange:e=>u(e.target.value),children:[(0,n.jsx)("option",{value:"2x",children:"2x"}),(0,n.jsx)("option",{value:"4x",children:"4x"}),(0,n.jsx)("option",{value:"6x",children:"6x"})]})]}),(0,n.jsxs)("label",{className:"small",style:{display:"flex",gap:8,alignItems:"center"},children:[(0,n.jsx)("input",{type:"checkbox",checked:h,onChange:e=>p(e.target.checked)})," Face enhancement"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"small",children:"Subject detection"}),(0,n.jsxs)("select",{className:"select",value:m,onChange:e=>f(e.target.value),children:[(0,n.jsx)("option",{value:"Foreground",children:"Foreground"}),(0,n.jsx)("option",{value:"Background",children:"Background"}),(0,n.jsx)("option",{value:"Off",children:"Off"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"small",children:"Face enhancement creativity"}),(0,n.jsx)("input",{className:"input",type:"number",step:.05,min:0,max:1,value:g,onChange:e=>v(parseFloat(e.target.value||"0"))})]})]}),(0,n.jsx)("button",{className:"btn",style:{marginTop:12},disabled:!e||x,onClick:C,children:x?"Enhancing…":"Enhance image"})]})]})}},2277:function(e,a,t){"use strict";var n=t(7437),s=t(2265),i=t(1180);a.Z=function(e){let{mediaUrl:a,kind:t,context:l,size:r="default"}=e,[o,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),[m,f]=(0,s.useState)("idle");async function g(){if(a){c(!0),p(null),u(!1);try{var e,n;let{data:{user:s}}=await i._.auth.getUser();if(!s)throw Error("Please sign in at /auth to save assets.");let r=await i._.auth.getSession(),o=(null===(e=r.data.session)||void 0===e?void 0:e.access_token)||"";f("pending");let c=await fetch("/api/assets/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?"Bearer ".concat(o):""},body:JSON.stringify({url:a,kind:t,context:l})});if(!c.ok)throw Error(await c.text());u(!0),f("indexing");try{let e=await c.json(),a=null==e?void 0:null===(n=e.asset)||void 0===n?void 0:n.id;if(a){let e=setInterval(async()=>{try{let{data:t}=await i._.from("media_assets").select("status").eq("id",a).single(),n=(null==t?void 0:t.status)||"pending";"ready"===n&&(f("ready"),clearInterval(e)),"error"===n&&(f("error"),clearInterval(e))}catch(e){}},2e3);setTimeout(()=>clearInterval(e),2e4)}else f("ready")}catch(e){f("ready")}}catch(e){p(e instanceof Error?e.message:"Failed to add to database")}finally{c(!1)}}}return(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8},children:[(0,n.jsx)("button",{className:"btn",type:"button","aria-label":"Add this media to database",onClick:g,onKeyDown:e=>(function(e){let{event:a,onActivate:t}=e;("Enter"===a.key||" "===a.key)&&t()})({event:e,onActivate:g}),disabled:o,style:{padding:"large"===r?"12px 14px":"6px 10px",width:"large"===r?"100%":void 0,fontSize:"large"===r?16:void 0},children:o?"Saving to database…":d?"Saved ✓":"Save to database"}),"idle"!==m&&(0,n.jsx)("span",{className:"badge","aria-live":"polite",children:"pending"===m?"Pending":"indexing"===m?"Indexing":"ready"===m?"Ready":"error"===m?"Error":""}),h&&(0,n.jsx)("div",{className:"small",style:{color:"#ff7878"},children:h})]})}},1180:function(e,a,t){"use strict";t.d(a,{_:function(){return n}});let n=(0,t(6887).eI)("https://ueunqeqrvtuofpdoozye.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVldW5xZXFydnR1b2ZwZG9venllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxOTM4NjMsImV4cCI6MjA3MTc2OTg2M30.JY5i-uB5vZJ6enhWVgf9Bwg9bK2BFjmuXuOfjbQEQUw",{auth:{persistSession:!0,autoRefreshToken:!0}})},8877:function(){}},function(e){e.O(0,[404,887,971,23,744],function(){return e(e.s=4206)}),_N_E=e.O()}]);